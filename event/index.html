<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>THE FINALS | Mini-Tournament</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* The Finals signature colors */
        --finals-orange: #ff6b35;
        --finals-cyan: #00d9ff;
        --finals-magenta: #ff006e;
        --finals-yellow: #ffd93d;
        --finals-purple: #9d4edd;

        /* UI colors */
        --bg-dark: #0a0a0a;
        --bg-panel: #111111;
        --bg-card: #1a1a1a;
        --border-subtle: #2a2a2a;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --text-muted: #666666;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        line-height: 1.6;
      }

      /* Subtle animated background */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(255, 107, 53, 0.05) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 50%,
            rgba(0, 217, 255, 0.05) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: 1;
      }

      /* Container */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
        position: relative;
        z-index: 2;
      }

      /* Header */
      header {
        padding: 3rem 0;
        text-align: center;
        position: relative;
      }

      .main-title {
        font-family: "Bebas Neue", sans-serif;
        font-size: clamp(4rem, 8vw, 7rem);
        letter-spacing: 0.05em;
        line-height: 0.9;
        margin-bottom: 0.5rem;
        background: linear-gradient(
          135deg,
          var(--finals-cyan),
          var(--finals-magenta)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
      }

      .subtitle {
        font-size: 1.2rem;
        color: var(--text-secondary);
        letter-spacing: 0.2em;
        text-transform: uppercase;
        font-weight: 600;
      }

      /* Stats grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Panel styling */
      .panel {
        background: var(--bg-panel);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        transition: transform 0.3s ease;
      }

      .panel:hover {
        transform: translateY(-4px);
      }

      .panel-header {
        background: var(--bg-card);
        padding: 1.5rem;
        border-bottom: 2px solid var(--border-subtle);
        position: relative;
      }

      .panel-title {
        font-family: "Bebas Neue", sans-serif;
        font-size: 1.8rem;
        letter-spacing: 0.05em;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .panel-icon {
        width: 24px;
        height: 24px;
        display: inline-block;
        background: linear-gradient(
          135deg,
          var(--finals-cyan),
          var(--finals-magenta)
        );
        -webkit-mask: radial-gradient(circle, white 40%, transparent 41%);
        mask: radial-gradient(circle, white 40%, transparent 41%);
      }

      /* Table styling */
      .data-table {
        width: 100%;
      }

      .data-table th {
        background: var(--bg-card);
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .data-table th:hover {
        color: var(--finals-cyan);
      }

      .data-table th:last-child {
        text-align: right;
      }

      .data-table td {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-subtle);
        transition: background-color 0.2s ease;
      }

      .data-table tr:last-child td {
        border-bottom: none;
      }

      .data-table tbody tr:hover {
        background: var(--bg-card);
      }

      /* Rank indicators */
      .rank {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .rank-1 {
        color: var(--finals-yellow);
        font-weight: 700;
      }

      .rank-1::before {
        content: "👑";
        font-size: 1.2rem;
      }

      .rank-2 {
        color: var(--finals-cyan);
        font-weight: 600;
      }

      .rank-3 {
        color: var(--finals-magenta);
        font-weight: 600;
      }

      /* Score styling */
      .score {
        font-family: "Bebas Neue", sans-serif;
        font-size: 1.4rem;
        letter-spacing: 0.05em;
        text-align: right;
      }

      .score.high {
        color: var(--finals-yellow);
        text-shadow: 0 0 10px rgba(255, 217, 61, 0.3);
      }

      /* Match results */
      .matches-section {
        background: var(--bg-panel);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 3rem;
      }

      .match-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .match-item {
        background: var(--bg-card);
        padding: 1.5rem;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .match-item:hover {
        transform: translateX(8px);
      }

      .match-item.latest {
        border: 2px solid var(--finals-orange);
      }

      .match-item.latest::before {
        content: "LATEST";
        position: absolute;
        top: 0;
        right: 0;
        background: var(--finals-orange);
        color: var(--bg-dark);
        padding: 0.25rem 1rem;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
      }

      .match-round {
        font-size: 0.875rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .match-result {
        font-family: "Bebas Neue", sans-serif;
        font-size: 1.3rem;
        letter-spacing: 0.05em;
        color: var(--text-primary);
      }

      /* Footer */
      footer {
        padding: 4rem 0 2rem;
        text-align: center;
        border-top: 1px solid var(--border-subtle);
      }

      .discord-link {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 2rem;
        background: linear-gradient(
          135deg,
          var(--finals-purple),
          var(--finals-magenta)
        );
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: all 0.3s ease;
        margin-bottom: 2rem;
      }

      .discord-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(157, 78, 221, 0.3);
      }

      .admin-credit {
        font-family: "Bebas Neue", sans-serif;
        font-size: 2rem;
        color: var(--finals-cyan);
        letter-spacing: 0.1em;
        margin: 1rem 0;
        opacity: 0.8;
      }

      .admin-link {
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.875rem;
        transition: color 0.2s ease;
      }

      .admin-link:hover {
        color: var(--text-secondary);
      }

      /* Loading state */
      .loading {
        text-align: center;
        padding: 3rem;
        color: var(--text-muted);
      }

      .loading::after {
        content: "";
        display: inline-block;
        width: 20px;
        height: 20px;
        margin-left: 10px;
        border: 2px solid var(--finals-cyan);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .panel {
        animation: fadeIn 0.6s ease-out;
        animation-fill-mode: both;
      }

      .panel:nth-child(1) {
        animation-delay: 0.1s;
      }
      .panel:nth-child(2) {
        animation-delay: 0.2s;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 0 1rem;
        }

        .main-title {
          font-size: 3rem;
        }

        .stats-grid {
          gap: 1.5rem;
        }

        .match-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }
      }

      /* Subtle hover effects */
      button,
      a,
      th,
      tr {
        transition: all 0.2s ease;
      }

      /* Hidden class */
      .hidden {
        display: none !important;
      }

      /* Tooltip styles */
      .tooltip-wrapper {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .tooltip-icon {
        display: inline-block;
        width: 16px;
        height: 16px;
        line-height: 16px;
        text-align: center;
        font-size: 0.75rem;
        color: var(--text-muted);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        cursor: help;
        transition: color 0.2s ease, background 0.2s ease;
      }

      .tooltip-wrapper:hover .tooltip-icon {
        color: var(--finals-cyan);
        background: rgba(0, 217, 255, 0.2);
      }

      .tooltip-content {
        position: absolute;
        width: 300px;
        padding: 1rem;
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        font-size: 0.875rem;
        line-height: 1.6;
        color: var(--text-primary);
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        pointer-events: none;
        bottom: calc(100% + 10px);
        left: 50%;
        transform: translateX(-50%);
      }

      .tooltip-content::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid var(--bg-card);
      }

      .tooltip-content::before {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 9px solid transparent;
        border-right: 9px solid transparent;
        border-top: 9px solid var(--border-subtle);
        margin-top: -1px;
        z-index: -1;
      }

      /* Responsive tooltip positioning */
      @media (max-width: 768px) {
        .tooltip-content {
          position: fixed;
          bottom: auto;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 300px;
        }
        
        .tooltip-content::after,
        .tooltip-content::before {
          display: none;
        }
      }

      .tooltip-wrapper:hover .tooltip-content,
      .tooltip-wrapper.active .tooltip-content {
        opacity: 1;
        visibility: visible;
      }

      .tooltip-title {
        font-weight: 600;
        color: var(--finals-cyan);
        margin-bottom: 0.5rem;
      }

      .tooltip-list {
        list-style: none;
        padding: 0;
        margin: 0.5rem 0;
      }

      .tooltip-list li {
        position: relative;
        padding-left: 1.25rem;
        margin-bottom: 0.25rem;
        color: var(--text-secondary);
      }

      .tooltip-list li::before {
        content: "•";
        position: absolute;
        left: 0;
        color: var(--finals-yellow);
        font-weight: bold;
      }

      .tooltip-note {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-subtle);
        color: var(--finals-yellow);
        font-weight: 600;
        text-align: center;
      }


      /* Prizes section */
      .prizes-section {
        background: var(--bg-panel);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 3rem;
      }

      .prizes-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
        margin-top: 1.5rem;
      }

      @media (max-width: 768px) {
        .prizes-grid {
          grid-template-columns: 1fr;
        }
      }

      .prize-card {
        background: var(--bg-card);
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease;
      }

      .prize-card:hover {
        transform: translateY(-4px);
      }

      .prize-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: filter 0.3s ease, transform 0.3s ease;
      }

      .prize-card:hover .prize-image {
        filter: brightness(1.1);
        transform: scale(1.05);
      }

      .prize-content {
        padding: 1.5rem;
      }

      .prize-emoji {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .prize-title {
        font-family: "Bebas Neue", sans-serif;
        font-size: 1.5rem;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }

      .prize-subtitle {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      .prize-items {
        font-size: 0.875rem;
        line-height: 1.8;
        color: var(--text-secondary);
      }

      .prize-items li {
        position: relative;
        padding-left: 1.5rem;
        margin-bottom: 0.5rem;
      }

      .prize-items li::before {
        content: "•";
        position: absolute;
        left: 0;
        font-weight: bold;
      }

      /* Prize category colors */
      .prize-first .prize-title {
        color: var(--finals-yellow);
      }

      .prize-first .prize-items li::before {
        color: var(--finals-yellow);
      }

      .prize-mvp .prize-title {
        color: var(--finals-cyan);
      }

      .prize-mvp .prize-items li::before {
        color: var(--finals-cyan);
      }

      .prize-raffle .prize-title {
        color: var(--finals-magenta);
      }

      .prize-raffle .prize-items li::before {
        color: var(--finals-magenta);
      }

      /* Round History Styles */
      .rounds-section {
        background: var(--bg-panel);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 3rem;
      }

      .rounds-timeline {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }

      .round-card {
        background: var(--bg-card);
        border-radius: 8px;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid var(--border-subtle);
      }

      .round-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        border-color: var(--finals-cyan);
      }

      .round-card h3 {
        font-family: "Bebas Neue", sans-serif;
        font-size: 1.4rem;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
        color: var(--finals-cyan);
      }

      .cash-extracted {
        font-size: 0.875rem;
        color: var(--finals-yellow);
        margin-bottom: 1rem;
        font-weight: 600;
      }

      .top-players {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .player-placement {
        padding: 0.5rem 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
        font-size: 0.875rem;
        transition: background 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .player-placement:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .player-placement.placement-1 {
        border-left: 3px solid var(--finals-yellow);
        color: var(--finals-yellow);
      }

      .player-placement.placement-2 {
        border-left: 3px solid var(--finals-cyan);
        color: var(--finals-cyan);
      }

      .player-placement.placement-3 {
        border-left: 3px solid var(--finals-magenta);
        color: var(--finals-magenta);
      }

      @media (max-width: 768px) {
        .rounds-timeline {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header>
        <h1 class="main-title">THE FINALS</h1>
        <p class="subtitle">Mini-Tournament</p>
      </header>

      <!-- Prizes Section -->
      <div class="prizes-section">
        <h2 class="panel-title">
          <span class="panel-icon"></span>
          TOURNAMENT PRIZES
        </h2>
        <div class="prizes-grid">
          <!-- 1st Place Prize -->
          <div class="prize-card prize-first">
            <img src="./images/merch.png" alt="THE FINALS merchandise - hat and t-shirts" class="prize-image">
            <div class="prize-content">
              <div class="prize-emoji">🏆</div>
              <h3 class="prize-title">1ST PLACE TEAM</h3>
              <ul class="prize-items" style="list-style: none; padding: 0;">
                <li>THE FINALS Merch (Choice of Shirt or Hat)</li>
                <li>Exclusive Discord Badge</li>
              </ul>
            </div>
          </div>

          <!-- MVP Prize -->
          <div class="prize-card prize-mvp">
            <img src="./images/merch.png" alt="THE FINALS merchandise - hat and t-shirts" class="prize-image">
            <div class="prize-content">
              <div class="prize-emoji">⭐</div>
              <h3 class="prize-title">MVP AWARD</h3>
              <p class="prize-subtitle">Top Individual Player</p>
              <ul class="prize-items" style="list-style: none; padding: 0;">
                <li>THE FINALS Merch (Choice of Shirt or Hat)</li>
              </ul>
            </div>
          </div>

          <!-- Raffle Prize -->
          <div class="prize-card prize-raffle">
            <img src="./images/stickers.png" alt="THE FINALS sticker pack" class="prize-image">
            <div class="prize-content">
              <div class="prize-emoji">🎲</div>
              <h3 class="prize-title">RAFFLE PRIZES</h3>
              <p class="prize-subtitle">2 Random Winners</p>
              <ul class="prize-items" style="list-style: none; padding: 0;">
                <li>THE FINALS Sticker Pack</li>
                <li>All participants eligible</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Team Rosters Section -->
      <div class="teams-section" style="background: var(--bg-panel); border-radius: 12px; padding: 2rem; margin-bottom: 3rem;">
        <h2 class="panel-title" style="margin-bottom: 1.5rem;">
          <span class="panel-icon"></span>
          TEAM ROSTERS
        </h2>
        <div class="teams-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
          <!-- Team A -->
          <div class="team-card" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; border: 2px solid var(--border-subtle); transition: all 0.3s ease;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 0.05em; color: var(--finals-yellow); margin-bottom: 1rem;">TEAM A</h3>
            <div class="player-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">ClassicArena</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">SonarAtlas</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">1-800-FAT-KUSH</div>
            </div>
          </div>
          <!-- Team B -->
          <div class="team-card" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; border: 2px solid var(--border-subtle); transition: all 0.3s ease;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 0.05em; color: var(--finals-cyan); margin-bottom: 1rem;">TEAM B</h3>
            <div class="player-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">Rezzae</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">1-800-FAT-TEDDY</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">Hobo</div>
            </div>
          </div>
          <!-- Team C -->
          <div class="team-card" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; border: 2px solid var(--border-subtle); transition: all 0.3s ease;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 0.05em; color: var(--finals-magenta); margin-bottom: 1rem;">TEAM C</h3>
            <div class="player-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">itsfishy</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">1-800-FAT-MOMS</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">JohnRedcorn619</div>
            </div>
          </div>
          <!-- Team D -->
          <div class="team-card" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; border: 2px solid var(--border-subtle); transition: all 0.3s ease;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 0.05em; color: var(--finals-purple); margin-bottom: 1rem;">TEAM D</h3>
            <div class="player-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">Pat</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">1-800-FAT-NUTZ</div>
              <div class="player-item" style="padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 4px; font-weight: 500;">CJR195</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading state -->
      <div id="loading" class="loading">Syncing tournament data</div>
      <div
        id="error"
        class="loading hidden"
        style="color: var(--finals-orange)"
      >
        Connection error. Retrying...
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid" id="statsGrid" style="display: none">
        <!-- Team Standings -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">
              <span class="panel-icon"></span>
              Team Standings
            </h2>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th onclick="sortTeams('name')">
                  Team <span style="opacity: 0.5">▼</span>
                </th>
                <th onclick="sortTeams('points')">
                  Points <span style="opacity: 0.5">▼</span>
                </th>
              </tr>
            </thead>
            <tbody id="teamsTable"></tbody>
          </table>
        </div>

        <!-- Player Rankings -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">
              <span class="panel-icon"></span>
              Player Rankings
            </h2>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th onclick="sortPlayers('name')">
                  Player <span style="opacity: 0.5">▼</span>
                </th>
                <th onclick="sortPlayers('score')">
                  <div class="tooltip-wrapper">
                    Impact Score
                    <span class="tooltip-icon">ⓘ</span>
                    <div class="tooltip-content">
                      <div class="tooltip-title">Impact Score Calculation:</div>
                      <ul class="tooltip-list">
                        <li>Eliminations × 3 points</li>
                        <li>Assists × 1 point</li>
                        <li>Deaths × -1 point</li>
                        <li>Objectives × 5 points</li>
                        <li>Revives × 4 points</li>
                        <li>Bonus points from combat/objective scores</li>
                      </ul>
                      <div class="tooltip-note">Higher score = Better performance!</div>
                    </div>
                  </div>
                  <span style="opacity: 0.5">▼</span>
                </th>
              </tr>
            </thead>
            <tbody id="playersTable"></tbody>
          </table>
        </div>
      </div>

      <!-- Match Results -->
      <div class="matches-section" id="matchesSection" style="display: none">
        <h2 class="panel-title" style="margin-bottom: 1.5rem">
          <span class="panel-icon"></span>
          Match Results
        </h2>
        <div class="match-list" id="matchesContainer"></div>
      </div>

      <!-- Footer -->
      <footer>
        <a href="https://discord.gg/yourserver" class="discord-link">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"
            />
          </svg>
          Join Discord
        </a>
        <div class="admin-credit">1-800-FAT-MOMS</div>
        <a href="admin/" class="admin-link">Admin Access</a>
      </footer>
    </div>

    <script>
      // Constants
      const POLL_INTERVAL = 30000;
      let tournamentData = { teams: [], players: [], matches: [] };
      let sortDirection = { teams: {}, players: {} };
      
      // Expected score ranges for validation
      const SCORE_RANGES = {
        min: 0,
        max: 100,
        suspicious: 150,
        typical: { min: 20, max: 80 }
      };

      // Debug mode
      const urlParams = new URLSearchParams(window.location.search);
      const debugMode = urlParams.get('debug') === 'true';
      
      // Initialize
      async function init() {
        await fetchData();
        setInterval(fetchData, POLL_INTERVAL);
      }

      // Fetch tournament data
      async function fetchData() {
        try {
          // Check if we're running locally
          if (
            window.location.protocol === "file:" ||
            window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1"
          ) {
            // Use test data for local development
            tournamentData = {
              teams: [
                { name: "Cashout Kings", points: 12 },
                { name: "Terminal Velocity", points: 9 },
                { name: "Power Shifters", points: 7 },
                { name: "Bank Breakers", points: 4 },
              ],
              players: [
                { name: "xXx_CashGod_xXx", score: 78.5 },
                { name: "DefuseOrDie", score: 65.3 },
                { name: "RPG_Spammer", score: 62.1 },
                { name: "LightningBolt", score: 58.7 },
                { name: "MediumEnjoyer", score: 52.4 },
              ],
              matches: [
                {
                  round: "1 - Quick Cash",
                  result: "Cashout Kings 3, Bank Breakers 0",
                },
                {
                  round: "2 - Terminal Attack",
                  result: "Terminal Velocity 2, Power Shifters 1",
                },
              ],
              rounds: []
            };
            showData();
            updateTables();
            return;
          }

          // Production mode - fetch from data.json
          const response = await fetch("data.json?t=" + Date.now());
          if (!response.ok) throw new Error("Failed to fetch data");

          const data = await response.json();
          
          // Ensure data has required structure
          tournamentData = {
            teams: data.teams || [],
            players: data.players || [],
            matches: data.matches || [],
            rounds: data.rounds || []
          };
          
          // Debug mode logging
          if (debugMode) {
            console.log('=== TOURNAMENT DATA DEBUG ===');
            console.log('Raw data from data.json:', data);
            console.table(tournamentData.players);
            console.table(tournamentData.teams);
            if (tournamentData.rounds && tournamentData.rounds.length > 0) {
              console.log('Rounds data:');
              tournamentData.rounds.forEach((round, idx) => {
                console.log(`Round ${round.roundNumber}:`);
                console.table(round.playerStats.map(p => ({
                  name: p.name,
                  team: p.team,
                  placement: p.placement,
                  impactScore: p.impactScore,
                  eliminations: p.stats.eliminations,
                  deaths: p.stats.deaths,
                  objectives: p.stats.objectives
                })));
              });
            }
            
            // Show debug info on page
            showDebugInfo();
          }
          
          showData();
          updateTables();
        } catch (error) {
          console.error("Error:", error);
          
          // Fallback to empty structure
          tournamentData = {
            teams: [],
            players: [],
            matches: [],
            rounds: []
          };
          
          // Show error message
          document.getElementById("loading").classList.add("hidden");
          document.getElementById("error").classList.remove("hidden");

          // Retry after 5 seconds
          setTimeout(() => {
            document.getElementById("error").classList.add("hidden");
            document.getElementById("loading").classList.remove("hidden");
            fetchData();
          }, 5000);
        }
      }

      // Calculate correct impact score
      function calculateCorrectImpactScore(stats) {
        // Ensure all values exist and are numbers
        const eliminations = stats.eliminations || 0;
        const assists = stats.assists || 0;
        const deaths = stats.deaths || 0;
        const objectives = stats.objectives || 0;
        const revives = stats.revives || 0;
        const combatScore = stats.combatScore || 0;
        const objectiveScore = stats.objectiveScore || 0;
        const supportScore = stats.supportScore || 0;
        
        // Calculate base score from primary stats
        const baseScore = (eliminations * 3) + 
                         (assists * 1) + 
                         (deaths * -1) + 
                         (objectives * 5) + 
                         (revives * 4);
        
        // Add bonus from secondary scores (capped to prevent inflation)
        const bonusScore = Math.min(
          (combatScore * 0.001) + 
          (objectiveScore * 0.001) + 
          (supportScore * 0.001),
          10 // Cap bonus at 10 points
        );
        
        const totalScore = baseScore + bonusScore;
        return Math.max(0, Math.round(totalScore * 10) / 10);
      }

      // Recalculate all player scores from rounds data
      function recalculateScoresFromRounds() {
        if (!tournamentData.rounds || tournamentData.rounds.length === 0) return;
        
        // Reset all players
        const playerStats = {};
        
        // Process each round
        tournamentData.rounds.forEach(round => {
          round.playerStats.forEach(playerStat => {
            if (!playerStats[playerStat.name]) {
              playerStats[playerStat.name] = {
                name: playerStat.name,
                team: playerStat.team,
                totalScore: 0,
                roundsPlayed: 0,
                stats: {
                  eliminations: 0,
                  deaths: 0,
                  assists: 0,
                  objectives: 0,
                  revives: 0
                }
              };
            }
            
            const player = playerStats[playerStat.name];
            player.roundsPlayed++;
            
            // Accumulate stats
            player.stats.eliminations += playerStat.stats.eliminations || 0;
            player.stats.deaths += playerStat.stats.deaths || 0;
            player.stats.assists += playerStat.stats.assists || 0;
            player.stats.objectives += playerStat.stats.objectives || 0;
            player.stats.revives += playerStat.stats.revives || 0;
            
            // Calculate round score correctly
            const roundScore = calculateCorrectImpactScore(playerStat.stats);
            player.totalScore += roundScore;
          });
        });
        
        // Calculate average scores and update player data
        const recalculatedPlayers = [];
        Object.values(playerStats).forEach(player => {
          recalculatedPlayers.push({
            name: player.name,
            score: Math.round((player.totalScore / player.roundsPlayed) * 10) / 10,
            team: player.team,
            roundsPlayed: player.roundsPlayed,
            totalEliminations: player.stats.eliminations,
            totalDeaths: player.stats.deaths
          });
        });
        
        // Update tournament data with recalculated scores
        if (recalculatedPlayers.length > 0) {
          tournamentData.players = recalculatedPlayers;
        }
      }

      // Validate player scores
      function validateScores() {
        // First try to recalculate from rounds data
        recalculateScoresFromRounds();
        
        const suspiciousPlayers = [];
        let hasInvalidScores = false;
        
        tournamentData.players.forEach(player => {
          if (player.score < SCORE_RANGES.min || isNaN(player.score)) {
            hasInvalidScores = true;
            player.score = 0; // Reset invalid scores
          } else if (player.score > SCORE_RANGES.suspicious) {
            suspiciousPlayers.push({
              name: player.name,
              score: player.score,
              issue: 'Extremely high score (likely calculation error)',
              suggestion: 'Check admin panel impact score formula'
            });
          } else if (player.score > SCORE_RANGES.max) {
            suspiciousPlayers.push({
              name: player.name,
              score: player.score,
              issue: 'Above typical maximum',
              suggestion: 'Verify round data'
            });
          }
        });
        
        // Show warning if suspicious scores found
        if (suspiciousPlayers.length > 0) {
          showDataWarning(suspiciousPlayers);
        }
        
        return !hasInvalidScores;
      }
      
      // Show data warning banner
      function showDataWarning(suspiciousPlayers) {
        // Remove existing warning if any
        const existingWarning = document.querySelector('.data-warning');
        if (existingWarning) existingWarning.remove();
        
        const warningDiv = document.createElement('div');
        warningDiv.className = 'data-warning';
        warningDiv.style.cssText = `
          background: rgba(255, 107, 53, 0.1);
          border: 2px solid var(--finals-orange);
          border-radius: 8px;
          padding: 1rem;
          margin: 1rem 0;
          text-align: center;
        `;
        
        const warningHTML = `
          <h3 style="color: var(--finals-orange); margin-bottom: 0.5rem; font-weight: 600;">
            ⚠️ Data Validation Warning
          </h3>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            Some player scores appear unusually high. Expected range: ${SCORE_RANGES.typical.min}-${SCORE_RANGES.typical.max}
          </p>
          <details style="text-align: left; max-width: 600px; margin: 0 auto;">
            <summary style="cursor: pointer; color: var(--finals-yellow); margin-bottom: 0.5rem;">
              View affected players (${suspiciousPlayers.length})
            </summary>
            <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
              ${suspiciousPlayers.map(p => `
                <div style="margin-bottom: 0.5rem; color: var(--text-secondary);">
                  <strong style="color: var(--finals-cyan);">${p.name}</strong>: 
                  ${p.score.toFixed(1)} points 
                  <span style="color: var(--finals-orange); font-size: 0.875rem;">(${p.issue})</span>
                  ${p.suggestion ? `<br><small style="color: var(--text-muted);">💡 ${p.suggestion}</small>` : ''}
                </div>
              `).join('')}
            </div>
          </details>
        `;
        
        warningDiv.innerHTML = warningHTML;
        
        // Insert after header
        const header = document.querySelector('header');
        header.parentNode.insertBefore(warningDiv, header.nextSibling);
      }

      // Show data panels
      function showData() {
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("error").classList.add("hidden");
        document.getElementById("statsGrid").style.display = "grid";
        document.getElementById("matchesSection").style.display = "block";
        
        // Validate scores
        validateScores();
        
        // Setup tooltip after content is loaded
        setTimeout(setupTooltip, 100);
      }

      // Update all tables
      function updateTables() {
        updateTeamsTable();
        updatePlayersTable();
        updateMatchesDisplay();
        displayRoundHistory();
      }

      // Update teams table
      function updateTeamsTable() {
        const tbody = document.getElementById("teamsTable");
        tbody.innerHTML = "";

        const sortedTeams = [...tournamentData.teams].sort(
          (a, b) => b.points - a.points
        );

        sortedTeams.forEach((team, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>
                        <span class="rank ${
                          index < 3 ? `rank-${index + 1}` : ""
                        }">
                            ${team.name}
                        </span>
                    </td>
                    <td>
                        <span class="score ${index === 0 ? "high" : ""}">
                            ${team.points}
                        </span>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // Update players table
      function updatePlayersTable() {
        const tbody = document.getElementById("playersTable");
        tbody.innerHTML = "";

        const sortedPlayers = [...tournamentData.players].sort(
          (a, b) => b.score - a.score
        );

        sortedPlayers.forEach((player, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>
                        <span class="rank ${
                          index < 3 ? `rank-${index + 1}` : ""
                        }">
                            ${player.name}
                        </span>
                    </td>
                    <td>
                        <span class="score ${index === 0 ? "high" : ""}">
                            ${player.score}
                        </span>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // Update matches display
      function updateMatchesDisplay() {
        const container = document.getElementById("matchesContainer");
        container.innerHTML = "";

        if (tournamentData.matches.length === 0) {
          container.innerHTML =
            '<div class="match-item"><span class="match-round">No matches played yet</span></div>';
          return;
        }

        // Show most recent matches first
        const reversedMatches = [...tournamentData.matches].reverse();

        reversedMatches.forEach((match, index) => {
          const matchDiv = document.createElement("div");
          matchDiv.className = `match-item ${index === 0 ? "latest" : ""}`;
          matchDiv.innerHTML = `
                    <span class="match-round">Round ${match.round}</span>
                    <span class="match-result">${match.result}</span>
                `;
          container.appendChild(matchDiv);
        });
      }

      // Display round history
      function displayRoundHistory() {
        if (!tournamentData.rounds || tournamentData.rounds.length === 0) return;
        
        // Check if rounds section already exists
        const existingSection = document.querySelector('.rounds-section');
        if (existingSection) {
          existingSection.remove();
        }
        
        const container = document.createElement('div');
        container.className = 'rounds-section';
        container.innerHTML = `
          <h2 class="panel-title">
            <span class="panel-icon"></span>
            ROUND HISTORY
          </h2>
          <div class="rounds-timeline">
            ${tournamentData.rounds.map((round, index) => `
              <div class="round-card">
                <h3>Round ${round.roundNumber} - ${round.gameMode}</h3>
                <p class="cash-extracted">${round.totalCashExtracted ? round.totalCashExtracted.toLocaleString() + ' extracted' : 'No cash data'}</p>
                <div class="top-players">
                  ${round.playerStats
                    .sort((a, b) => a.placement - b.placement)
                    .slice(0, 3)
                    .map(p => `
                      <div class="player-placement placement-${p.placement}">
                        <span>${p.placement}. ${p.name}</span>
                        <span>${p.stats.eliminations}/${p.stats.deaths}</span>
                      </div>
                    `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        `;
        
        // Insert after matches section
        const matchesSection = document.getElementById('matchesSection');
        if (matchesSection && matchesSection.parentNode) {
          matchesSection.parentNode.insertBefore(container, matchesSection.nextSibling);
        } else {
          // Fallback: append to container
          document.querySelector('.container').appendChild(container);
        }
      }

      // Sorting functions
      function sortTeams(field) {
        const direction = sortDirection.teams[field] || "desc";
        tournamentData.teams.sort((a, b) => {
          if (field === "name") {
            return direction === "asc"
              ? a.name.localeCompare(b.name)
              : b.name.localeCompare(a.name);
          } else {
            return direction === "asc"
              ? a.points - b.points
              : b.points - a.points;
          }
        });
        sortDirection.teams[field] = direction === "asc" ? "desc" : "asc";
        updateTeamsTable();
      }

      function sortPlayers(field) {
        const direction = sortDirection.players[field] || "desc";
        tournamentData.players.sort((a, b) => {
          if (field === "name") {
            return direction === "asc"
              ? a.name.localeCompare(b.name)
              : b.name.localeCompare(a.name);
          } else {
            return direction === "asc" ? a.score - b.score : b.score - a.score;
          }
        });
        sortDirection.players[field] = direction === "asc" ? "desc" : "asc";
        updatePlayersTable();
      }

      // Tooltip positioning
      function setupTooltip() {
        const tooltipWrapper = document.querySelector('.tooltip-wrapper');
        const tooltipContent = document.querySelector('.tooltip-content');
        
        if (!tooltipWrapper || !tooltipContent) return;
        
        // For mobile - click handler
        tooltipWrapper.addEventListener('click', function(e) {
          e.stopPropagation();
          tooltipWrapper.classList.toggle('active');
        });
        
        // Close tooltip when clicking outside (mobile)
        document.addEventListener('click', function() {
          const activeTooltip = document.querySelector('.tooltip-wrapper.active');
          if (activeTooltip) {
            activeTooltip.classList.remove('active');
          }
        });
      }
      
      // Show debug info on page
      function showDebugInfo() {
        const debugDiv = document.createElement('div');
        debugDiv.className = 'debug-info';
        debugDiv.style.cssText = `
          background: rgba(0, 0, 0, 0.9);
          border: 2px solid var(--finals-yellow);
          border-radius: 8px;
          padding: 1rem;
          margin: 1rem;
          font-family: monospace;
          font-size: 0.875rem;
          color: var(--finals-yellow);
          position: fixed;
          bottom: 1rem;
          right: 1rem;
          max-width: 400px;
          max-height: 300px;
          overflow-y: auto;
          z-index: 9999;
        `;
        
        const scores = tournamentData.players.map(p => `${p.name}: ${p.score}`).join(', ');
        const avgScore = tournamentData.players.length > 0 
          ? (tournamentData.players.reduce((sum, p) => sum + p.score, 0) / tournamentData.players.length).toFixed(1)
          : 0;
        
        debugDiv.innerHTML = `
          <h4 style="margin-bottom: 0.5rem; color: var(--finals-cyan);">🐛 DEBUG MODE</h4>
          <div>Players: ${tournamentData.players.length}</div>
          <div>Teams: ${tournamentData.teams.length}</div>
          <div>Rounds: ${tournamentData.rounds?.length || 0}</div>
          <div>Avg Score: ${avgScore}</div>
          <details style="margin-top: 0.5rem;">
            <summary style="cursor: pointer;">Player Scores</summary>
            <div style="margin-top: 0.5rem; word-wrap: break-word;">${scores}</div>
          </details>
          <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted);">
            Press F12 for console logs
          </div>
        `;
        
        // Remove existing debug div if any
        const existingDebug = document.querySelector('.debug-info');
        if (existingDebug) existingDebug.remove();
        
        document.body.appendChild(debugDiv);
      }
      
      // Start the app
      init();
    </script>
  </body>
</html>
