<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="canonical" href="https://www.thefinalsloadout.com/" />

    <!-- Performance Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://static.cloudflareinsights.com" />

    <!-- Preload Critical Resources - Logo is LCP element -->
    <!-- Removed unused preload: <link rel="preload" href="/images/the-finals-logo.webp" as="image" type="image/webp" fetchpriority="high" /> -->

    <!-- Meta Tags -->
    <title>The Finals BEST Random Loadout Generator | Fun & Unique Loadouts</title>
    <meta name="description" content="Get the best random loadouts for The Finals game to have fun and be challenged. Find new weapon builds for Light, Medium, and Heavy playstyles." />
    <meta name="author" content="Paul Takisaki" />
    <link rel="author" href="https://www.paultakisaki.com/" />

    <!-- Open Graph -->
    <meta property="og:title" content="The Finals Loadout Roulette" />
    <meta property="og:description" content="Randomize your loadout and dominate The Finals with style." />
    <meta property="og:image" content="https://www.thefinalsloadout.com/wt-progress/images/social1200x630.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:url" content="https://www.thefinalsloadout.com/" />
    <meta property="og:type" content="website" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="The Finals Loadout Roulette" />
    <meta name="twitter:description" content="Spin the wheel. Wreck the arena." />
    <meta name="twitter:image" content="https://www.thefinalsloadout.com/wt-progress/images/social1200x630.png" />

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "The Finals Loadout Generator",
        "url": "https://www.thefinalsloadout.com",
        "description": "A random loadout generator for The Finals game with optimized weapons and gadgets for different playstyles.",
        "image": "https://www.thefinalsloadout.com/images/the-finals-logo.webp",
        "author": {
            "@type": "Person",
            "name": "Paul Takisaki",
            "url": "https://www.paultakisaki.com"
        }
    }
    </script>

    <!-- Fonts - Optimized Loading (Non-blocking) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Load fonts asynchronously to prevent render blocking -->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;900&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;900&display=swap" media="print" onload="this.media='all'; this.onload=null;">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;900&display=swap">
    </noscript>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GVGKYFGZ1Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag("js", new Date());
        gtag("config", "G-GVGKYFGZ1Z");
    </script>

    <!-- Console noise control for production -->
    <script>
        window.DEBUG = false;
        if (!window.DEBUG) {
            console.log = function() {};
            console.debug = function() {};
        }
    </script>
    <style>
        /* Premium Vegas-Style Slot Machine Design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #fff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            width: 100%;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-family: 'Bebas Neue', cursive;
            font-size: 3.5rem;
            background: linear-gradient(135deg, #ff3366, #ff6699);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 51, 102, 0.5);
        }

        .subtitle {
            color: #888;
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        /* Header Logo Styling */
        .header-logo {
            max-width: 300px;  /* Reduced from 600px to half size */
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            filter: drop-shadow(0 0 30px rgba(255, 51, 102, 0.3));
            animation: logoGlow 3s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            from {
                filter: drop-shadow(0 0 20px rgba(255, 51, 102, 0.3));
            }
            to {
                filter: drop-shadow(0 0 40px rgba(255, 51, 102, 0.5));
            }
        }

        /* Premium Slot Machine Container */
        .slot-machine-premium {
            width: 90%;
            max-width: 900px;
            background: linear-gradient(180deg, #1a1a1a 0%, #111 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 
                0 0 100px rgba(255, 51, 102, 0.2),
                inset 0 2px 10px rgba(0, 0, 0, 0.5),
                inset 0 -2px 10px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        /* Glow Effects */
        .slot-machine-premium::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 51, 102, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Top Controls Section */
        .controls-section {
            position: relative;
            z-index: 10;
            margin-bottom: 30px;
        }

        /* Random Everything Button */
        .random-all-premium {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #6a1b9a, #ff3366);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 10px 30px rgba(106, 27, 154, 0.4),
                inset 0 2px 5px rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .random-all-premium::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }

        .random-all-premium:hover::after {
            animation: shine 0.5s ease-in-out;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .random-all-premium:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 15px 40px rgba(106, 27, 154, 0.6),
                inset 0 2px 5px rgba(255, 255, 255, 0.3);
        }

        .dice-icon {
            font-size: 2rem;
            animation: roll 2s ease-in-out infinite;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        /* Selection Grid */
        .selection-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .selection-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 51, 102, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .selection-title {
            color: #888;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .selection-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Selection Buttons */
        .select-btn {
            flex: 1;
            min-width: 40px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .select-btn:hover {
            border-color: rgba(255, 51, 102, 0.5);
            color: #fff;
            transform: translateY(-2px);
        }

        .select-btn.active {
            background: linear-gradient(135deg, #ff3366, #ff6699);
            border-color: #ff3366;
            color: white;
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.4);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 51, 102, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 51, 102, 0.6); }
        }

        /* Class Buttons Special Styling */
        .class-btn-premium {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            gap: 5px;
        }

        .class-icon-premium {
            font-size: 1.5rem;
        }

        /* Slot Display Area */
        .slot-display {
            background: #000;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            box-shadow: 
                inset 0 5px 15px rgba(0, 0, 0, 0.8),
                0 0 50px rgba(255, 51, 102, 0.1);
        }

        /* Spin Counter */
        .spin-counter {
            position: absolute;
            top: -15px;
            right: 20px;
            background: linear-gradient(135deg, #ff3366, #ff6699);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            box-shadow: 0 5px 15px rgba(255, 51, 102, 0.4);
            z-index: 100;
        }

        /* Slot Columns */
        .slot-columns {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            min-height: 300px;
        }

        .slot-column {
            background: linear-gradient(180deg, #0a0a0a 0%, #1a1a1a 100%);
            border-radius: 10px;
            padding: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .column-header {
            text-align: center;
            color: #666;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 51, 102, 0.2);
            margin-bottom: 15px;
        }

        .slot-window {
            height: 240px;
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(
                transparent, 
                black 10%, 
                black 90%, 
                transparent
            );
            -webkit-mask-image: linear-gradient(
                transparent, 
                black 10%, 
                black 90%, 
                transparent
            );
        }

        .slot-items {
            position: absolute;
            width: 100%;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.16, 0.99);
        }

        .slot-item {
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
        }

        .slot-item img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.5));
        }

        .slot-item-name {
            font-size: 0.7rem;
            color: #888;
            text-align: center;
            margin-top: 5px;
        }

        .slot-item.winner {
            animation: winnerFlash 0.7s ease-out forwards;
            position: relative;
            z-index: 10;
        }

        /* Persistent pulsing glow for winners */
        .slot-item.winner-glow {
            animation: persistentGlow 2s ease-in-out infinite;
            position: relative;
            z-index: 10;
            box-shadow: 
                0 0 20px rgba(255, 51, 102, 0.6),
                inset 0 0 20px rgba(255, 51, 102, 0.2);
            border: 2px solid rgba(255, 51, 102, 0.5);
        }

        @keyframes persistentGlow {
            0%, 100% {
                box-shadow: 
                    0 0 20px rgba(255, 51, 102, 0.6),
                    inset 0 0 20px rgba(255, 51, 102, 0.2);
                border-color: rgba(255, 51, 102, 0.5);
                transform: scale(1);
            }
            50% {
                box-shadow: 
                    0 0 40px rgba(255, 51, 102, 0.9),
                    inset 0 0 30px rgba(255, 51, 102, 0.4);
                border-color: rgba(255, 51, 102, 0.8);
                transform: scale(1.05);
            }
        }

        @keyframes winnerFlash {
            0% { background: transparent; }
            50% { 
                background: radial-gradient(circle, rgba(255, 51, 102, 0.5) 0%, transparent 70%);
                transform: scale(1.1);
            }
            100% { 
                background: radial-gradient(circle, rgba(255, 51, 102, 0.3) 0%, rgba(255, 51, 102, 0.1) 70%);
                box-shadow: 0 0 20px rgba(255, 51, 102, 0.5), inset 0 0 15px rgba(255, 51, 102, 0.2);
                transform: scale(1.02);
            }
        }
        
        /* Victory Sparks Container */
        #victorySparks {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 100;
            width: 100%;
            height: 100%;
        }
        
        /* Individual Spark */
        .spark {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ffffff 0%, #ff3366 40%, #ff66aa 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px #ff3366, 0 0 30px #ff66aa, 0 0 45px rgba(255, 51, 102, 0.5);
            transform-origin: center;
            pointer-events: none;
            z-index: 99999;
            margin-left: -4px;
            margin-top: -4px;
        }
        
        @keyframes sparkBurst {
            0% {
                transform: scale(0) translate(0, 0);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) translate(calc(var(--x) * 0.5), calc(var(--y) * 0.5));
                opacity: 1;
            }
            100% {
                transform: scale(0.3) translate(var(--x), var(--y));
                opacity: 0;
            }
        }

        /* Spinning Animation */
        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-2400px); }
        }

        .spinning .slot-items {
            animation: spin 3s cubic-bezier(0.17, 0.67, 0.16, 0.99);
        }

        /* Victory Effects */
        .victory-sparks {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 1000;
        }

        .spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffeb3b;
            border-radius: 50%;
            animation: sparkle 1s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 0;
            }
        }

        /* Generate Button */
        .generate-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #ff3366, #ff6699);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .generate-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 51, 102, 0.4);
        }

        /* Responsive - Keep all 5 columns visible */
        @media (max-width: 768px) {
            /* Compact navigation on mobile */
            .main-nav {
                padding: 0.25rem 0.5rem;
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .nav-links {
                gap: 0.25rem;
                width: 100%;
                justify-content: center;
            }
            
            .nav-link {
                padding: 0.25rem 0.5rem;
                font-size: 0.7rem;
            }
            
            .header {
                padding: 10px 5px;
                margin-bottom: 15px;
            }

            .header-logo {
                max-width: 175px;  /* Reduced from 350px to half size */
            }
            
            .title { 
                font-size: 1.8rem; 
                line-height: 1;
                margin-bottom: 5px;
            }
            
            .slot-machine-premium {
                width: 95%;
                padding: 20px 15px;
            }
            
            .selection-grid { 
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            /* Keep all 5 columns but make them narrower */
            .slot-columns { 
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }
            
            .slot-column {
                padding: 5px;
            }
            
            .column-header {
                font-size: 0.65rem;
                padding: 8px 2px;
                letter-spacing: 0;
            }
            
            .slot-window {
                /* Dynamic height for tablets */
                height: calc(100vh - 400px);
                min-height: 280px;
                max-height: 400px;
                mask-image: linear-gradient(
                    black 0%, 
                    black 100%
                );
                -webkit-mask-image: linear-gradient(
                    black 0%, 
                    black 100%
                );
            }
            
            .slot-item {
                height: 70px;
                padding: 8px 5px;
                background: linear-gradient(180deg, transparent, rgba(0,0,0,0.2), transparent);
            }
            
            .slot-item img {
                width: 40px;
                height: 40px;
            }
            
            .slot-item-name {
                font-size: 0.6rem;
                line-height: 1.1;
            }
        }

        @media (max-width: 480px) {
            /* Ultra-compact navigation on phones */
            .main-nav {
                padding: 3px !important;
                min-height: auto !important;
            }
            
            .nav-links {
                gap: 2px !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .nav-link {
                padding: 2px 4px !important;
                font-size: 9px !important;
                letter-spacing: -0.5px !important;
                line-height: 1.2 !important;
            }
            
            /* Use abbreviated text on mobile */
            .nav-link {
                font-size: 0 !important; /* Hide original text */
            }
            
            .nav-link::after {
                font-size: 9px !important;
                content: attr(data-mobile);
            }
            
            .nav-link:nth-child(1)::after { content: 'LOADOUT'; }
            .nav-link:nth-child(2)::after { content: 'SLOTS'; }
            .nav-link:nth-child(3)::after { content: 'RAGE'; }
            .nav-link:nth-child(4)::after { content: 'PATCH'; }
            .nav-link:nth-child(5)::after { content: 'META'; }
            .nav-link:nth-child(6)::after { content: 'WT'; }
            
            .nav-controls {
                display: none; /* Hide filter controls on small phones */
            }
            
            .header {
                padding: 5px 3px !important;
                margin-bottom: 5px !important;
            }
            
            .title { 
                font-size: 14px !important;
                margin-bottom: 2px !important;
                line-height: 1 !important;
            }
            
            .subtitle {
                display: none; /* Hide subtitle on mobile to save space */
            }
            
            .slot-machine-premium { 
                width: 98%;
                padding: 15px 10px;
                border-radius: 15px;
            }
            
            /* Still keep all 5 columns, just even narrower */
            .slot-columns { 
                grid-template-columns: repeat(5, 1fr);
                gap: 5px;
            }
            
            .slot-column {
                padding: 3px;
                border-radius: 8px;
            }
            
            .column-header {
                font-size: 0.55rem;
                padding: 6px 2px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .slot-window {
                /* Make height fill available space on mobile */
                height: calc(100vh - 380px); /* Viewport minus header/controls/padding */
                min-height: 300px; /* At least 5 items visible */
                max-height: 450px; /* Cap for usability */
                mask-image: linear-gradient(
                    black 0%, 
                    black 100%
                );
                -webkit-mask-image: linear-gradient(
                    black 0%, 
                    black 100%
                );
                /* Add subtle background for continuity */
                background: linear-gradient(to bottom,
                    rgba(138, 43, 226, 0.03) 0%,
                    rgba(138, 43, 226, 0.06) 50%,
                    rgba(138, 43, 226, 0.03) 100%);
            }
            
            .slot-item {
                height: 60px;
                padding: 5px 3px;
                background: linear-gradient(135deg,
                    rgba(30, 30, 40, 0.7) 0%,
                    rgba(25, 25, 35, 0.9) 100%);
                margin: 0;
                border-bottom: 1px solid rgba(138, 43, 226, 0.1);
            }
            
            .slot-item img {
                width: 35px;
                height: 35px;
            }
            
            .slot-item-name {
                font-size: 0.55rem;
                margin-top: 2px;
            }
            
            .random-all-premium {
                padding: 15px;
                font-size: 1.2rem;
            }
            
            .selection-options {
                gap: 5px;
            }
            
            .select-btn {
                min-width: 35px;
                padding: 8px 5px;
                font-size: 0.9rem;
            }
            
            .class-btn-premium {
                padding: 10px 5px;
            }
            
            .class-icon-premium {
                font-size: 1.2rem;
            }
            
            .generate-button {
                padding: 15px;
                font-size: 1.1rem;
            }
            
            .spin-counter {
                font-size: 0.8rem;
                padding: 4px 12px;
                top: -12px;
                right: 10px;
            }
        }
        
        /* Ultra small screens */
        @media (max-width: 360px) {
            .slot-columns {
                gap: 3px;
            }
            
            .column-header {
                font-size: 0.5rem;
                padding: 5px 1px;
            }
            
            .slot-window {
                height: 165px; /* Exactly 3 items at 55px each */
            }
            
            .slot-item {
                height: 55px;
            }
            
            .slot-item img {
                width: 30px;
                height: 30px;
            }
            
            .slot-item-name {
                font-size: 0.5rem;
            }
        }
        /* Navigation Bar Styles */
        /* Scroll Progress Bar */
        .scroll-progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 10001;
        }

        .scroll-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff3366, #ff6699);
            width: 0%;
            transition: width 0.1s ease-out;
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
        }

        .main-nav {
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 51, 102, 0.2);
            position: sticky;
            top: 4px; /* Push down by progress bar height */
            z-index: 1000;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .nav-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .filter-toggle-button {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid rgba(255, 51, 102, 0.3);
            color: #ff3366;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .filter-toggle-button:hover {
            background: rgba(255, 51, 102, 0.2);
            border-color: #ff3366;
            transform: translateY(-2px);
        }
        
        /* Filter Panel Styles */
        .filter-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .filter-panel-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .filter-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            max-width: 90vw;
            height: 100vh;
            background: rgba(20, 20, 25, 0.98);
            border-left: 2px solid rgba(255, 51, 102, 0.3);
            z-index: 1999;
            overflow-y: auto;
            transition: right 0.3s ease;
            padding: 1rem;
        }
        
        .filter-panel.active {
            right: 0;
        }
        
        .filter-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 51, 102, 0.2);
        }
        
        .filter-panel-title {
            font-size: 1.5rem;
            color: #ff3366;
            font-weight: 700;
        }
        
        .close-filter-panel {
            background: transparent;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-filter-panel:hover {
            color: #ff3366;
        }
        
        .filter-section {
            margin-bottom: 2rem;
        }
        
        .filter-class-title {
            color: #ff3366;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }
        
        .filter-category {
            margin-bottom: 1.5rem;
        }
        
        .filter-category-title {
            color: #00f0c0;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-items {
            display: grid;
            gap: 0.5rem;
        }
        
        .filter-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem;
            transition: background 0.2s;
            border-radius: 4px;
        }
        
        .filter-item:hover {
            background: rgba(255, 51, 102, 0.05);
        }
        
        .filter-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #ff3366;
            cursor: pointer;
        }
        
        .filter-item label {
            color: #ccc;
            cursor: pointer;
            flex: 1;
            font-size: 0.9rem;
        }
        
        .filter-actions {
            position: sticky;
            bottom: 0;
            background: rgba(20, 20, 25, 0.98);
            padding: 1rem 0;
            border-top: 1px solid rgba(255, 51, 102, 0.2);
            display: flex;
            gap: 1rem;
        }
        
        .filter-btn {
            flex: 1;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .apply-filters {
            background: rgba(0, 240, 192, 0.1);
            border-color: #00f0c0;
            color: #00f0c0;
        }
        
        .apply-filters:hover {
            background: rgba(0, 240, 192, 0.2);
            transform: translateY(-2px);
        }
        
        .clear-filters {
            background: rgba(255, 51, 102, 0.1);
            border-color: #ff3366;
            color: #ff3366;
        }
        
        .clear-filters:hover {
            background: rgba(255, 51, 102, 0.2);
            transform: translateY(-2px);
        }
        
        .select-all-checkbox {
            margin-left: auto;
            font-size: 0.8rem;
            color: #888;
        }
        
        .nav-link {
            color: #888;
            text-decoration: none;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            transition: color 0.3s;
            text-transform: uppercase;
        }
        
        .nav-link:hover {
            color: #ff3366;
        }
        
        .nav-link.active {
            color: #ff3366;
            border-bottom: 2px solid #ff3366;
        }
        
        /* History Section Styles */
        .history-section {
            margin-top: 3rem;
            padding: 2rem 1rem;
            background: rgba(10, 10, 15, 0.8);
            border-top: 2px solid rgba(255, 51, 102, 0.2);
        }
        
        .history-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .history-title {
            font-size: 1.8rem;
            color: #ff3366;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .history-count {
            color: #888;
            font-size: 1rem;
        }
        
        .clear-history-btn {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid #ff3366;
            color: #ff3366;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .clear-history-btn:hover {
            background: rgba(255, 51, 102, 0.2);
            transform: translateY(-2px);
        }
        
        .history-list {
            display: grid;
            gap: 1rem;
        }
        
        .history-item {
            background: rgba(20, 20, 25, 0.9);
            border: 1px solid rgba(255, 51, 102, 0.2);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            border-color: #ff3366;
            background: rgba(30, 30, 35, 0.9);
            transform: translateX(4px);
        }
        
        .loadout-details {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .loadout-class {
            color: #ff3366;
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 80px;
        }
        
        .loadout-equipment {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .equipment-item {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        .equipment-label {
            color: #888;
            font-size: 0.7rem;
            text-transform: uppercase;
        }
        
        .equipment-value {
            color: #fff;
        }
        
        .copy-btn {
            background: rgba(0, 240, 192, 0.1);
            border: 1px solid #00f0c0;
            color: #00f0c0;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            background: rgba(0, 240, 192, 0.2);
            transform: scale(1.05);
        }
        
        .copy-btn.copied {
            background: rgba(80, 200, 120, 0.2);
            border-color: #50c878;
            color: #50c878;
        }
        
        .empty-history {
            text-align: center;
            color: #666;
            padding: 3rem 1rem;
            font-style: italic;
        }
        
        /* Footer Styles */
        footer {
            text-align: center;
            padding: 1.5rem 1rem;
            color: #888;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(10, 10, 15, 0.9);
            font-size: 0.75rem;
        }
        
        .support-section {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(80, 200, 120, 0.05) 0%, rgba(0, 255, 204, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(80, 200, 120, 0.2);
        }
        
        .support-btn {
            display: inline-block;
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, #50c878, #00ffcc);
            color: #0a0a0f;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(80, 200, 120, 0.3);
        }
        
        .support-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(80, 200, 120, 0.5);
        }
        
        /* Mobile Responsive History */
        @media (max-width: 768px) {
            .loadout-details {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .loadout-equipment {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .history-item {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .copy-btn {
                width: 100%;
                padding: 0.6rem;
            }
        }
    </style>
</head>
<body>
    <!-- Scroll Progress Bar -->
    <div class="scroll-progress-container">
        <div class="scroll-progress-bar" id="scrollProgress"></div>
    </div>
    
    <!-- Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-links">
            <a href="/v3/" class="nav-link active">LOADOUT GENERATOR</a>
            <a href="/ragequit/" class="nav-link">RAGE QUIT</a>
            <a href="/patch-notes/" class="nav-link">PATCH NOTES</a>
            <a href="/meta-weapons/" class="nav-link">META WEAPONS</a>
            <a href="/wt-progress/" class="nav-link">WORLD TOUR</a>
        </div>
        <div class="nav-controls">
            <button id="filter-toggle" class="filter-toggle-button" aria-label="Toggle filters">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                    <circle cx="7" cy="6" r="2" fill="currentColor"></circle>
                    <circle cx="17" cy="12" r="2" fill="currentColor"></circle>
                    <circle cx="10" cy="18" r="2" fill="currentColor"></circle>
                </svg>
                <span>Filters</span>
            </button>
        </div>
    </nav>

    <!-- Header -->
    <header class="header">
        <!-- Logo image - easy to revert by uncommenting text below and removing img -->
        <img src="/images/logo final.webp" alt="The Finals Premium Slot Machine" class="header-logo">
        <!-- Previous logos: 
        <img src="/images/logo-header.webp" alt="The Finals Premium Slot Machine" class="header-logo">
        <img src="/images/logo-header-v2.webp" alt="The Finals Premium Slot Machine" class="header-logo"> 
        -->
        <!-- Original text header (backup) - uncomment to restore:
        <h1 class="title">THE FINALS</h1>
        <h1 class="title">PREMIUM SLOT MACHINE</h1>
        <p class="subtitle">Vegas-Style Loadout Generator</p>
        -->
    </header>

    <!-- Premium Slot Machine Container -->
    <div class="slot-machine-premium">
        <!-- Controls Section -->
        <div class="controls-section">
            <!-- Random Everything Button -->
            <button class="random-all-premium" id="randomAllBtn">
                <span class="dice-icon">üé≤</span>
                <span>RANDOM EVERYTHING</span>
            </button>

            <!-- Selection Grid -->
            <div class="selection-grid">
                <!-- Spin Selection -->
                <div class="selection-panel">
                    <div class="selection-title">Select # of Spins</div>
                    <div class="selection-options">
                        <button class="select-btn spin-btn" data-spins="1">1</button>
                        <button class="select-btn spin-btn" data-spins="2">2</button>
                        <button class="select-btn spin-btn" data-spins="3">3</button>
                        <button class="select-btn spin-btn" data-spins="4">4</button>
                        <button class="select-btn spin-btn" data-spins="5">5</button>
                    </div>
                </div>

                <!-- Class Selection -->
                <div class="selection-panel">
                    <div class="selection-title">Select Your Class</div>
                    <div class="selection-options">
                        <button class="select-btn class-btn-premium" data-class="light">
                            <span class="class-icon-premium">‚ö°</span>
                            <span>LIGHT</span>
                        </button>
                        <button class="select-btn class-btn-premium" data-class="medium">
                            <span class="class-icon-premium">‚öîÔ∏è</span>
                            <span>MEDIUM</span>
                        </button>
                        <button class="select-btn class-btn-premium" data-class="heavy">
                            <span class="class-icon-premium">üõ°Ô∏è</span>
                            <span>HEAVY</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slot Display Area -->
        <div class="slot-display" id="slotDisplay">
            <div class="spin-counter" id="spinCounter" style="display: none;">
                SPIN <span id="currentSpin">1</span> OF <span id="totalSpins">3</span>
            </div>

            <!-- Slot Columns -->
            <div class="slot-columns" id="premiumSlotColumns">
                <!-- Columns will be dynamically generated -->
            </div>
        </div>

        <!-- Generate Button -->
        <button class="generate-button" id="generateBtn" disabled>
            SELECT OPTIONS ABOVE
        </button>
    </div>

    <!-- Victory Sparks Container -->
    <div class="victory-sparks" id="victorySparks"></div>

    <!-- Hidden container for app initialization -->
    <div id="slot-machine-container" style="display: none;">
        <!-- The app needs this container to initialize -->
    </div>

    <!-- Load the main app scripts -->
    <script src="/v3/app-optimized.js?v=20250831-fix"></script>
    
    <!-- Load the premium integration -->
    <script src="/v3/premium-integrated.js?v=20250831"></script>
    
    <!-- Victory Sparks positioning fix -->
    <script>
        // Fix sparks container positioning
        window.addEventListener('DOMContentLoaded', () => {
            const sparksContainer = document.getElementById('victorySparks');
            if (sparksContainer) {
                // Move it inside the slot display area
                const slotDisplay = document.getElementById('slotDisplay');
                if (slotDisplay) {
                    slotDisplay.appendChild(sparksContainer);
                    sparksContainer.style.position = 'absolute';
                    sparksContainer.style.top = '50%';
                    sparksContainer.style.left = '50%';
                    sparksContainer.style.transform = 'translate(-50%, -50%)';
                    sparksContainer.style.pointerEvents = 'none';
                    sparksContainer.style.zIndex = '1000';
                }
            }
        });
    </script>
    
    <!-- Victory Sparks Container -->
    <div id="victorySparks"></div>
    
    <!-- Filter Panel -->
    <div class="filter-panel-overlay" id="filter-panel-overlay"></div>
    <div class="filter-panel" id="filter-panel">
        <div class="filter-panel-header">
            <h2 class="filter-panel-title">Filter Equipment</h2>
            <button class="close-filter-panel" id="close-filter-panel">‚úï</button>
        </div>
        <div id="filter-content">
            <!-- Filter content will be dynamically populated -->
        </div>
        <div class="filter-actions">
            <button class="filter-btn clear-filters" id="clear-filters">Clear All</button>
            <button class="filter-btn apply-filters" id="apply-filters">Apply Filters</button>
        </div>
    </div>
    
    <!-- History Section -->
    <section class="history-section">
        <div class="history-container">
            <div class="history-header">
                <h2 class="history-title">
                    <span>üé∞</span>
                    <span>Loadout History</span>
                    <span class="history-count" id="historyCount">(0)</span>
                </h2>
                <button class="clear-history-btn" id="clearHistoryBtn">Clear All History</button>
            </div>
            <div class="history-list" id="historyList">
                <div class="empty-history">No loadouts generated yet. Spin the slots to get started!</div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="support-section">
            <div style="display:flex;align-items:center;justify-content:center;gap:1rem;flex-wrap:wrap;">
                <span style="font-size:1.5rem;">‚òï</span>
                <div>
                    <p style="margin:0;color:#50c878;font-weight:600;font-size:0.9rem;">Enjoying the premium slot machine?</p>
                    <p style="margin:0.25rem 0 0.75rem 0;color:#b8bfc6;font-size:0.8rem;">Help keep it running with a coffee!</p>
                </div>
            </div>
            <a href="https://ko-fi.com/nextroundonme" target="_blank" rel="noopener" class="support-btn">
                <span>üíö Support Me</span>
            </a>
        </div>
        
        <p style="margin:0 0 0.5rem 0;">
            ¬© 2025 TheFinalsLoadout.com | Created by 
            <a href="https://www.paultakisaki.com/" rel="author" style="color:#00f0c0;text-decoration:none;">Paul Takisaki</a>
        </p>
        <div style="display:flex;justify-content:center;gap:2rem;flex-wrap:wrap;font-size:0.75rem;margin-top:0.5rem;">
            <a href="/legal/" style="color:#00f0c0;text-decoration:none;">Legal Disclaimer</a>
            <a href="https://thefinalsloadout.com/feedback" style="color:#ffd700;text-decoration:none;">üìù Submit Feedback</a>
        </div>
    </footer>
    
    <!-- History Management Script -->
    <script>
        class LoadoutHistory {
            constructor() {
                this.maxHistory = 5;
                this.historyKey = 'premiumSlotHistory';
                this.init();
            }
            
            init() {
                this.loadHistory();
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // Clear history button
                const clearBtn = document.getElementById('clearHistoryBtn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => this.clearHistory());
                }
            }
            
            loadHistory() {
                const saved = localStorage.getItem(this.historyKey);
                this.history = saved ? JSON.parse(saved) : [];
                this.render();
            }
            
            addLoadout(loadout) {
                if (!loadout) return;
                
                // Add timestamp and unique ID
                const entry = {
                    ...loadout,
                    id: Date.now(),
                    timestamp: new Date().toLocaleTimeString()
                };
                
                // Add to beginning and limit to maxHistory
                this.history.unshift(entry);
                if (this.history.length > this.maxHistory) {
                    this.history = this.history.slice(0, this.maxHistory);
                }
                
                // Save and render
                this.saveHistory();
                this.render();
            }
            
            saveHistory() {
                localStorage.setItem(this.historyKey, JSON.stringify(this.history));
            }
            
            clearHistory() {
                if (confirm('Clear all loadout history?')) {
                    this.history = [];
                    this.saveHistory();
                    this.render();
                }
            }
            
            copyLoadout(loadout) {
                const text = `Class: ${loadout.class || 'Unknown'}
Weapon: ${loadout.weapon}
Specialization: ${loadout.specialization}
Gadget 1: ${loadout.gadget1}
Gadget 2: ${loadout.gadget2}
Gadget 3: ${loadout.gadget3}`;
                
                navigator.clipboard.writeText(text).then(() => {
                    // Show copied feedback
                    event.target.classList.add('copied');
                    event.target.textContent = '‚úì Copied!';
                    setTimeout(() => {
                        event.target.classList.remove('copied');
                        event.target.textContent = 'üìã Copy';
                    }, 2000);
                });
            }
            
            render() {
                const container = document.getElementById('historyList');
                const count = document.getElementById('historyCount');
                
                if (!container) return;
                
                // Update count
                if (count) {
                    count.textContent = `(${this.history.length})`;
                }
                
                // Render history items
                if (this.history.length === 0) {
                    container.innerHTML = '<div class="empty-history">No loadouts generated yet. Spin the slots to get started!</div>';
                } else {
                    container.innerHTML = this.history.map(item => `
                        <div class="history-item">
                            <div class="loadout-details">
                                <div class="loadout-class">${item.class || 'Unknown'}</div>
                                <div class="loadout-equipment">
                                    <div class="equipment-item">
                                        <span class="equipment-label">Weapon</span>
                                        <span class="equipment-value">${item.weapon}</span>
                                    </div>
                                    <div class="equipment-item">
                                        <span class="equipment-label">Spec</span>
                                        <span class="equipment-value">${item.specialization}</span>
                                    </div>
                                    <div class="equipment-item">
                                        <span class="equipment-label">Gadget 1</span>
                                        <span class="equipment-value">${item.gadget1}</span>
                                    </div>
                                    <div class="equipment-item">
                                        <span class="equipment-label">Gadget 2</span>
                                        <span class="equipment-value">${item.gadget2}</span>
                                    </div>
                                    <div class="equipment-item">
                                        <span class="equipment-label">Gadget 3</span>
                                        <span class="equipment-value">${item.gadget3}</span>
                                    </div>
                                </div>
                            </div>
                            <button class="copy-btn" data-id="${item.id}">üìã Copy</button>
                        </div>
                    `).join('');
                    
                    // Add copy event listeners
                    container.querySelectorAll('.copy-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = parseInt(e.target.dataset.id);
                            const loadout = this.history.find(h => h.id === id);
                            if (loadout) this.copyLoadout(loadout);
                        });
                    });
                }
            }
        }
        
        // Initialize history manager
        window.loadoutHistory = new LoadoutHistory();
        
        // Hook into the premium slot machine to capture loadouts
        const originalStartSlotMachine = window.premiumIntegrated?.startSlotMachine;
        if (window.premiumIntegrated && originalStartSlotMachine) {
            window.premiumIntegrated.startSlotMachine = async function() {
                const result = await originalStartSlotMachine.apply(this, arguments);
                
                // Add loadout to history after generation
                if (this.currentLoadout) {
                    const loadout = {
                        ...this.currentLoadout,
                        class: this.selectedClass ? this.selectedClass.charAt(0).toUpperCase() + this.selectedClass.slice(1) : 'Unknown'
                    };
                    window.loadoutHistory.addLoadout(loadout);
                }
                
                return result;
            }.bind(window.premiumIntegrated);
        }
    </script>
    
    <!-- Filter System Script -->
    <script>
        class FilterSystem {
            constructor() {
                this.filterState = {};
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.loadFilterState();
                
                // Wait for premium integrated to be ready
                const checkReady = setInterval(() => {
                    if (window.premiumIntegrated && window.premiumIntegrated.loadoutData) {
                        clearInterval(checkReady);
                        this.populateFilters();
                    }
                }, 100);
            }
            
            setupEventListeners() {
                // Toggle button
                const toggleBtn = document.getElementById('filter-toggle');
                if (toggleBtn) {
                    toggleBtn.addEventListener('click', () => this.togglePanel());
                }
                
                // Close button
                const closeBtn = document.getElementById('close-filter-panel');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => this.closePanel());
                }
                
                // Overlay click
                const overlay = document.getElementById('filter-panel-overlay');
                if (overlay) {
                    overlay.addEventListener('click', () => this.closePanel());
                }
                
                // Apply button
                const applyBtn = document.getElementById('apply-filters');
                if (applyBtn) {
                    applyBtn.addEventListener('click', () => this.applyFilters());
                }
                
                // Clear button
                const clearBtn = document.getElementById('clear-filters');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => this.clearAllFilters());
                }
            }
            
            togglePanel() {
                const panel = document.getElementById('filter-panel');
                const overlay = document.getElementById('filter-panel-overlay');
                
                if (panel && overlay) {
                    const isActive = panel.classList.contains('active');
                    if (isActive) {
                        this.closePanel();
                    } else {
                        panel.classList.add('active');
                        overlay.classList.add('active');
                    }
                }
            }
            
            closePanel() {
                const panel = document.getElementById('filter-panel');
                const overlay = document.getElementById('filter-panel-overlay');
                
                if (panel && overlay) {
                    panel.classList.remove('active');
                    overlay.classList.remove('active');
                }
            }
            
            populateFilters() {
                const container = document.getElementById('filter-content');
                if (!container || !window.premiumIntegrated) return;
                
                const data = window.premiumIntegrated.getGameData();
                if (!data) return;
                
                container.innerHTML = '';
                
                ['Light', 'Medium', 'Heavy'].forEach(className => {
                    const section = document.createElement('div');
                    section.className = 'filter-section';
                    section.innerHTML = `<h3 class="filter-class-title">${className} Class</h3>`;
                    
                    // Weapons
                    const weaponsDiv = this.createFilterCategory('Weapons', data[className].weapons, className, 'weapon');
                    section.appendChild(weaponsDiv);
                    
                    // Specializations
                    const specsDiv = this.createFilterCategory('Specializations', data[className].specializations, className, 'specialization');
                    section.appendChild(specsDiv);
                    
                    // Gadgets
                    const gadgetsDiv = this.createFilterCategory('Gadgets', data[className].gadgets, className, 'gadget');
                    section.appendChild(gadgetsDiv);
                    
                    container.appendChild(section);
                });
            }
            
            createFilterCategory(title, items, className, type) {
                const div = document.createElement('div');
                div.className = 'filter-category';
                
                const titleDiv = document.createElement('div');
                titleDiv.className = 'filter-category-title';
                titleDiv.innerHTML = `
                    <span>${title}</span>
                    <label class="select-all-checkbox">
                        <input type="checkbox" data-class="${className}" data-type="${type}" data-select-all="true" checked>
                        <span>Select All</span>
                    </label>
                `;
                div.appendChild(titleDiv);
                
                const itemsDiv = document.createElement('div');
                itemsDiv.className = 'filter-items';
                
                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'filter-item';
                    itemDiv.innerHTML = `
                        <input type="checkbox" id="${className}-${type}-${item}" 
                               data-class="${className}" 
                               data-type="${type}" 
                               value="${item}" 
                               checked>
                        <label for="${className}-${type}-${item}">${item}</label>
                    `;
                    itemsDiv.appendChild(itemDiv);
                });
                
                div.appendChild(itemsDiv);
                
                // Setup select all functionality
                const selectAll = titleDiv.querySelector('[data-select-all]');
                if (selectAll) {
                    selectAll.addEventListener('change', (e) => {
                        const checkboxes = itemsDiv.querySelectorAll('input[type="checkbox"]');
                        checkboxes.forEach(cb => cb.checked = e.target.checked);
                    });
                }
                
                // Update select all when individual items change
                itemsDiv.addEventListener('change', () => {
                    const total = itemsDiv.querySelectorAll('input[type="checkbox"]').length;
                    const checked = itemsDiv.querySelectorAll('input[type="checkbox"]:checked').length;
                    if (selectAll) {
                        selectAll.checked = checked === total;
                        selectAll.indeterminate = checked > 0 && checked < total;
                    }
                });
                
                return div;
            }
            
            applyFilters() {
                if (!window.premiumIntegrated) return;
                
                const filterState = {
                    Light: { weapons: [], specializations: [], gadgets: [] },
                    Medium: { weapons: [], specializations: [], gadgets: [] },
                    Heavy: { weapons: [], specializations: [], gadgets: [] }
                };
                
                // Get all unchecked items (these will be filtered out)
                const uncheckedBoxes = document.querySelectorAll('#filter-content input[type="checkbox"]:not(:checked):not([data-select-all])');
                
                uncheckedBoxes.forEach(checkbox => {
                    const className = checkbox.dataset.class;
                    const type = checkbox.dataset.type;
                    const value = checkbox.value;
                    
                    if (type === 'weapon') {
                        filterState[className].weapons.push(value);
                    } else if (type === 'specialization') {
                        filterState[className].specializations.push(value);
                    } else if (type === 'gadget') {
                        filterState[className].gadgets.push(value);
                    }
                });
                
                // Validate filters
                const errors = this.validateFilters(filterState);
                if (errors.length > 0) {
                    alert('Filter validation failed:\n\n' + errors.join('\n'));
                    return;
                }
                
                // Apply filters
                window.premiumIntegrated.filterState = filterState;
                window.premiumIntegrated.saveFilterState();
                
                this.closePanel();
                
                // Show confirmation
                this.showToast('Filters applied successfully!');
            }
            
            validateFilters(filterState) {
                const errors = [];
                const data = window.premiumIntegrated.getGameData();
                
                ['Light', 'Medium', 'Heavy'].forEach(className => {
                    const classData = data[className];
                    const filters = filterState[className];
                    
                    // Check weapons
                    const availableWeapons = classData.weapons.filter(w => !filters.weapons.includes(w));
                    if (availableWeapons.length === 0) {
                        errors.push(`${className}: At least 1 weapon must be available`);
                    }
                    
                    // Check specializations
                    const availableSpecs = classData.specializations.filter(s => !filters.specializations.includes(s));
                    if (availableSpecs.length === 0) {
                        errors.push(`${className}: At least 1 specialization must be available`);
                    }
                    
                    // Check gadgets
                    const availableGadgets = classData.gadgets.filter(g => !filters.gadgets.includes(g));
                    if (availableGadgets.length < 3) {
                        errors.push(`${className}: At least 3 gadgets must be available`);
                    }
                });
                
                return errors;
            }
            
            clearAllFilters() {
                const checkboxes = document.querySelectorAll('#filter-content input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = true);
                
                if (window.premiumIntegrated) {
                    window.premiumIntegrated.filterState = {
                        Light: { weapons: [], specializations: [], gadgets: [] },
                        Medium: { weapons: [], specializations: [], gadgets: [] },
                        Heavy: { weapons: [], specializations: [], gadgets: [] }
                    };
                    window.premiumIntegrated.saveFilterState();
                }
                
                this.showToast('All filters cleared!');
            }
            
            loadFilterState() {
                if (!window.premiumIntegrated) return;
                
                const filterState = window.premiumIntegrated.filterState;
                if (!filterState) return;
                
                // Apply saved filter state to checkboxes
                Object.keys(filterState).forEach(className => {
                    const classFilters = filterState[className];
                    
                    // Uncheck filtered items
                    classFilters.weapons.forEach(item => {
                        const checkbox = document.querySelector(`#${className}-weapon-${item}`);
                        if (checkbox) checkbox.checked = false;
                    });
                    
                    classFilters.specializations.forEach(item => {
                        const checkbox = document.querySelector(`#${className}-specialization-${item}`);
                        if (checkbox) checkbox.checked = false;
                    });
                    
                    classFilters.gadgets.forEach(item => {
                        const checkbox = document.querySelector(`#${className}-gadget-${item}`);
                        if (checkbox) checkbox.checked = false;
                    });
                });
            }
            
            showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'filter-toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 240, 192, 0.9);
                    color: #000;
                    padding: 1rem 2rem;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 2000;
                    animation: slideUp 0.3s ease;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideDown 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 2000);
            }
        }
        
        // Add toast animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from { transform: translate(-50%, 100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes slideDown {
                from { transform: translate(-50%, 0); opacity: 1; }
                to { transform: translate(-50%, 100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize filter system
        window.filterSystem = new FilterSystem();
        
        // Scroll Progress Bar
        function updateScrollProgress() {
            const scrollTop = window.scrollY;
            const documentHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercentage = documentHeight > 0 ? (scrollTop / documentHeight) * 100 : 0;
            const progressBar = document.getElementById('scrollProgress');
            if (progressBar) {
                progressBar.style.width = Math.min(scrollPercentage, 100) + '%';
            }
        }

        // Update on scroll
        window.addEventListener('scroll', updateScrollProgress);
        // Update on resize
        window.addEventListener('resize', updateScrollProgress);
        // Initial update
        document.addEventListener('DOMContentLoaded', updateScrollProgress);
    </script>
</body>
</html>