<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS Overlay Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2a2a2a;
            color: white;
            padding: 20px;
        }
        button {
            background: #ff4796;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            border-radius: 5px;
        }
        button:hover {
            background: #ff71b0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .url-box {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .url {
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #0f0;
            margin: 10px 0;
        }
        h1 {
            color: #ff4796;
        }
        .status {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ OBS Overlay Direct Test</h1>

        <div class="status">
            <h3>üìä Current Status:</h3>
            <div id="status">Checking...</div>
        </div>

        <div class="url-box">
            <h3>üîó Your OBS URL (Use this in OBS Browser Source):</h3>
            <div class="url" id="obsUrl"></div>
            <p>Settings: Width: 600px, Height: 200px</p>
        </div>

        <h2>Test Loadouts:</h2>
        <button onclick="setLight()">Light Build</button>
        <button onclick="setMedium()">Medium Build</button>
        <button onclick="setHeavy()">Heavy Build</button>
        <button onclick="clearLoadout()">Clear</button>

        <h2>Instructions:</h2>
        <ol>
            <li>Click one of the test buttons above</li>
            <li>Copy the URL shown</li>
            <li>In OBS, add a Browser Source</li>
            <li>Paste the URL</li>
            <li>Set Width: 600px, Height: 200px</li>
            <li>The loadout should appear immediately</li>
        </ol>
    </div>

    <script>
        // Generate OBS URL
        const baseUrl = window.location.origin;
        const obsUrl = `${baseUrl}/overlay/?channel=default`;
        document.getElementById('obsUrl').textContent = obsUrl;

        function updateStatus() {
            const stored = localStorage.getItem('loadout_overlay_default');
            if (stored) {
                try {
                    const loadout = JSON.parse(stored);
                    document.getElementById('status').innerHTML = `
                        ‚úÖ Loadout stored: ${loadout.class} - ${loadout.name}<br>
                        Last updated: ${new Date(loadout.timestamp).toLocaleString()}
                    `;
                } catch (e) {
                    document.getElementById('status').textContent = '‚ùå Error parsing stored loadout';
                }
            } else {
                document.getElementById('status').textContent = '‚ö†Ô∏è No loadout stored yet';
            }
        }

        function setLoadout(data) {
            // Store in localStorage
            localStorage.setItem('loadout_overlay_default', JSON.stringify(data));

            // Also try BroadcastChannel
            try {
                const bc = new BroadcastChannel('loadout_overlay_channel');
                bc.postMessage({
                    type: 'loadout_update',
                    loadout: data
                });
                bc.close();
            } catch (e) {
                console.log('BroadcastChannel not available');
            }

            // Update status
            updateStatus();

            console.log('‚úÖ Loadout set:', data);
        }

        function setLight() {
            setLoadout({
                class: 'Light',
                name: 'Speed Demon',
                weapon: { name: 'XP-54', image: '/images/XP-54.webp' },
                specialization: { name: 'Grappling Hook', image: '/images/Grappling_Hook.webp' },
                gadgets: [
                    { name: 'Smoke Grenade', image: '/images/Smoke_Grenade.webp' },
                    { name: 'Stun Gun', image: '/images/Stun_Gun.webp' },
                    { name: 'Flashbang', image: '/images/Flashbang.webp' }
                ],
                timestamp: new Date().toISOString()
            });
        }

        function setMedium() {
            setLoadout({
                class: 'Medium',
                name: 'Support Pro',
                weapon: { name: 'FCAR', image: '/images/FCAR.webp' },
                specialization: { name: 'Healing Beam', image: '/images/Healing_Beam.webp' },
                gadgets: [
                    { name: 'Defibrillator', image: '/images/Defibrillator.webp' },
                    { name: 'Jump Pad', image: '/images/Jump_Pad.webp' },
                    { name: 'Gas Grenade', image: '/images/Gas_Grenade.webp' }
                ],
                timestamp: new Date().toISOString()
            });
        }

        function setHeavy() {
            setLoadout({
                class: 'Heavy',
                name: 'Tank Master',
                weapon: { name: 'SA1216', image: '/images/SA1216.webp' },
                specialization: { name: 'Mesh Shield', image: '/images/Mesh_Shield.webp' },
                gadgets: [
                    { name: 'RPG-7', image: '/images/RPG-7.webp' },
                    { name: 'C4', image: '/images/C4.webp' },
                    { name: 'Barricade', image: '/images/Barricade.webp' }
                ],
                timestamp: new Date().toISOString()
            });
        }

        function clearLoadout() {
            localStorage.removeItem('loadout_overlay_default');
            updateStatus();
        }

        // Initial status check
        updateStatus();
        setInterval(updateStatus, 1000);
    </script>
</body>
</html>