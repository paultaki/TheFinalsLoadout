<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin Counter Manual Test</title>
    
    <!-- Jam.dev Recording & Capture -->
    <meta name="jam:team" content="89d666eb-996b-4246-949a-939265963095" />
    <script type="module" src="https://js.jam.dev/recorder.js"></script>
    <script type="module" src="https://js.jam.dev/capture.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .test-container {
            background: #1a1a1a;
            border: 2px solid #ff3366;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #ff3366;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .instructions {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .instruction-step {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .highlight {
            color: #00ff88;
            font-weight: bold;
        }
        
        .warning {
            color: #ffaa00;
            font-weight: bold;
        }
        
        .test-iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #000;
        }
        
        .console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        
        .success-indicator {
            display: none;
            background: #00ff88;
            color: #000;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
        }
        
        .success-indicator.show {
            display: block;
        }
        
        .failure-indicator {
            display: none;
            background: #ff0044;
            color: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
        }
        
        .failure-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üé∞ Spin Counter Progression - Manual Test</h1>
        
        <div class="instructions">
            <h3>Testing Instructions:</h3>
            <div class="instruction-step">
                1. Click the <span class="highlight">"GENERATE LOADOUT"</span> button below
            </div>
            <div class="instruction-step">
                2. Watch the <span class="highlight">spin counter</span> in the top area
            </div>
            <div class="instruction-step">
                3. It should show: <span class="highlight">1 of 5</span> ‚Üí <span class="highlight">2 of 5</span> ‚Üí <span class="highlight">3 of 5</span> ‚Üí etc.
            </div>
            <div class="instruction-step">
                4. <span class="warning">FAIL</span> if it jumps directly to <span class="warning">5 of 5</span>
            </div>
            <div class="instruction-step">
                5. Check the console output below for verification
            </div>
        </div>
        
        <iframe 
            id="test-frame" 
            src="index.html" 
            class="test-iframe">
        </iframe>
        
        <div id="console-output" class="console-output">
            Console output will appear here...
        </div>
        
        <div id="success-indicator" class="success-indicator">
            ‚úÖ TEST PASSED! Counter shows proper progression!
        </div>
        
        <div id="failure-indicator" class="failure-indicator">
            ‚ùå TEST FAILED! Counter jumped to final value!
        </div>
    </div>
    
    <script>
        const consoleDiv = document.getElementById('console-output');
        const successDiv = document.getElementById('success-indicator');
        const failureDiv = document.getElementById('failure-indicator');
        
        let counterValues = [];
        let spinStarted = false;
        
        // Monitor iframe console
        window.addEventListener('load', () => {
            const iframe = document.getElementById('test-frame');
            
            iframe.onload = () => {
                const iframeWindow = iframe.contentWindow;
                
                // Override console.log in iframe
                const originalLog = iframeWindow.console.log;
                iframeWindow.console.log = function(...args) {
                    const message = args.join(' ');
                    
                    // Display in our console output
                    const timestamp = new Date().toLocaleTimeString();
                    consoleDiv.innerHTML += `[${timestamp}] ${message}\n`;
                    consoleDiv.scrollTop = consoleDiv.scrollHeight;
                    
                    // Track counter values
                    if (message.includes('of 5') || message.includes('of 3')) {
                        // Extract the counter value
                        const match = message.match(/(\d+)\s*of\s*(\d+)/);
                        if (match) {
                            const current = parseInt(match[1]);
                            const total = parseInt(match[2]);
                            counterValues.push({ current, total, message });
                            
                            // Check for progression
                            checkProgression();
                        }
                    }
                    
                    // Check for spin start
                    if (message.includes('SPIN] start') || message.includes('Spin 1')) {
                        spinStarted = true;
                        consoleDiv.innerHTML += '\nüéØ SPIN SEQUENCE STARTED - MONITORING COUNTER...\n\n';
                    }
                    
                    // Call original console.log
                    originalLog.apply(iframeWindow.console, args);
                };
                
                consoleDiv.innerHTML = 'Console monitoring active. Click "GENERATE LOADOUT" in the frame above.\n\n';
            };
        });
        
        function checkProgression() {
            if (counterValues.length < 2) return;
            
            // Check if we have a proper sequence
            let hasProgression = false;
            let jumpDetected = false;
            
            for (let i = 1; i < counterValues.length; i++) {
                const prev = counterValues[i - 1];
                const curr = counterValues[i];
                
                if (curr.current === prev.current + 1) {
                    hasProgression = true;
                    consoleDiv.innerHTML += `‚úÖ Good progression: ${prev.current} ‚Üí ${curr.current}\n`;
                } else if (curr.current > prev.current + 1) {
                    jumpDetected = true;
                    consoleDiv.innerHTML += `‚ùå JUMP DETECTED: ${prev.current} ‚Üí ${curr.current}\n`;
                }
            }
            
            // Show results after enough samples
            if (counterValues.length >= 3) {
                if (hasProgression && !jumpDetected) {
                    successDiv.classList.add('show');
                    failureDiv.classList.remove('show');
                } else if (jumpDetected) {
                    failureDiv.classList.add('show');
                    successDiv.classList.remove('show');
                }
            }
        }
        
        // Add keyboard shortcut for testing
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') {
                // Reset test
                counterValues = [];
                spinStarted = false;
                consoleDiv.innerHTML = 'Test reset. Click "GENERATE LOADOUT" to test again.\n\n';
                successDiv.classList.remove('show');
                failureDiv.classList.remove('show');
            }
        });
    </script>
</body>
</html>