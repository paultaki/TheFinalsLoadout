<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Landing Position Fix</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #0f0;
        }
        .pass { color: #0f0; border-color: #0f0; }
        .fail { color: #f00; border-color: #f00; }
        button {
            background: #0f0;
            color: #000;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Landing Position Fix Verification</h1>
    
    <div class="status">
        <h2>Fix Summary:</h2>
        <ul>
            <li>✅ Fixed animation not running for intermediate spins</li>
            <li>✅ Added safety check for 0px starting position</li>
            <li>✅ Snap to exact -1520px on completion</li>
            <li>✅ Tighter completion criteria</li>
        </ul>
    </div>
    
    <button onclick="testLanding()">TEST LANDING POSITION</button>
    <button onclick="window.location.href='/v3/'">OPEN MAIN APP</button>
    
    <div id="results"></div>
    
    <iframe id="test-frame" src="/v3/" style="width: 100%; height: 400px; border: 1px solid #333; margin-top: 20px;"></iframe>
    
    <script>
        async function testLanding() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="status">Testing...</div>';
            
            const iframe = document.getElementById('test-frame');
            const iframeDoc = iframe.contentDocument;
            const iframeWin = iframe.contentWindow;
            
            // Wait a bit for page to load
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Click generate button
            const btn = iframeDoc.getElementById('generate-btn');
            if (btn) {
                btn.click();
                
                // Monitor for completion
                let checks = 0;
                const interval = setInterval(() => {
                    checks++;
                    
                    const columns = iframeDoc.querySelectorAll('.slot-items');
                    if (columns.length > 0) {
                        const transforms = Array.from(columns).map(col => {
                            const style = iframeWin.getComputedStyle(col);
                            return style.transform;
                        });
                        
                        // Check if animation has settled (after 4 seconds)
                        if (checks > 40) {
                            clearInterval(interval);
                            
                            let output = '<div class="status"><h3>Results:</h3>';
                            transforms.forEach((transform, i) => {
                                // Extract Y position
                                let yPos = 0;
                                if (transform && transform !== 'none') {
                                    const match = transform.match(/matrix.*\(.*,.*,.*,.*,.*,\s*([^)]+)\)/);
                                    if (match) {
                                        yPos = parseFloat(match[1]);
                                    }
                                }
                                
                                const isCorrect = Math.abs(yPos - (-1520)) <= 2;
                                output += `<div class="${isCorrect ? 'pass' : 'fail'}">`;
                                output += `Column ${i + 1}: ${yPos.toFixed(2)}px `;
                                output += isCorrect ? '✅ CORRECT' : `❌ OFF BY ${Math.abs(yPos - (-1520)).toFixed(2)}px`;
                                output += '</div>';
                            });
                            output += '</div>';
                            
                            results.innerHTML = output;
                        }
                    }
                    
                    if (checks > 100) {
                        clearInterval(interval);
                        results.innerHTML = '<div class="status fail">Timeout!</div>';
                    }
                }, 100);
            } else {
                results.innerHTML = '<div class="status fail">Could not find generate button!</div>';
            }
        }
        
        // Auto-run test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Page loaded, ready for testing');
            }, 2000);
        });
    </script>
</body>
</html>