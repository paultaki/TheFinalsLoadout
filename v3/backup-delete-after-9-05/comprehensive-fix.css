/**
 * Comprehensive Fix for All Remaining Issues
 * 1. Fix final spin alignment
 * 2. Fix pre-slot animations being cut off
 * 3. Fix container jumping
 * 4. Ensure proper horizontal alignment
 */

/* === SLOT WINDOW HEIGHT FIX === */
.slot-window,
.slot-viewport {
  height: 240px !important;  /* 3 items Ã— 80px */
  max-height: 240px !important;
  min-height: 240px !important;
  overflow: hidden !important;
  position: relative !important;
}

/* === ITEM HEIGHT & ALIGNMENT === */
.slot-item {
  height: 80px !important;
  max-height: 80px !important;
  min-height: 80px !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  box-sizing: border-box !important;
  padding: 4px !important;
}

/* === FIX LANDING POSITION === */
/* Override the transform to ensure proper landing */
.slot-items {
  /* Winner at index 20 with 80px items should land at -1440px 
     to appear at bottom of 240px viewport */
  will-change: transform !important;
}

/* When animation completes, ensure alignment */
.animation-complete .slot-items {
  /* Force pixel-perfect alignment */
  transform: translateY(-1440px) !important;
}

/* === FIX PRE-SLOT CONTAINER === */
.pre-slot-container {
  min-height: 400px !important;  /* Give enough space for animations */
  height: auto !important;
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  justify-content: center !important;
  align-items: center !important;
  margin-bottom: 2rem !important;
}

/* Ensure pre-slot animations aren't cut off */
.pre-slot-container > * {
  position: relative !important;
  z-index: 10 !important;
}

/* Class selection needs space */
.class-selection {
  min-height: 300px !important;
  padding: 2rem 0 !important;
}

.class-option {
  min-height: 200px !important;
}

/* Spin selection needs space */
.spin-selection {
  min-height: 200px !important;
  padding: 2rem 0 !important;
}

/* === FIX CONTAINER JUMPING === */
/* Use visibility instead of display to prevent reflow */
#loadout-result {
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  position: relative !important;
  min-height: 300px !important;  /* Reserve space to prevent jumping */
}

#loadout-result.visible {
  visibility: visible !important;
  opacity: 1 !important;
}

/* Keep slot machine container stable */
.slot-machine-container {
  min-height: 500px !important;  /* Reserve space */
  position: relative !important;
  transition: opacity 0.3s ease;
}

/* === HORIZONTAL ALIGNMENT FIX === */
/* Ensure all columns align at the same baseline */
.slot-columns {
  display: flex !important;
  align-items: stretch !important;  /* Make all columns same height */
  justify-content: center !important;
}

.slot-column {
  display: flex !important;
  flex-direction: column !important;
}

.slot-window {
  flex: 1 1 auto !important;
  display: flex !important;
  align-items: flex-end !important;  /* Align to bottom */
}

/* Ensure consistent transform origin */
.slot-items {
  transform-origin: center top !important;
}

/* === WINNER ALIGNMENT === */
/* After animation completes, ensure winners are aligned */
.slot-column.complete .slot-items {
  /* All columns should have same transform for alignment */
  transform: translateY(-1440px) !important;
}

/* === MOBILE ADJUSTMENTS === */
@media (max-width: 768px) {
  .slot-window,
  .slot-viewport {
    height: 200px !important;  /* 2.5 items on mobile */
  }
  
  /* Adjust landing for mobile viewport */
  .animation-complete .slot-items,
  .slot-column.complete .slot-items {
    transform: translateY(-1480px) !important;  /* Adjusted for 200px viewport */
  }
  
  .pre-slot-container {
    min-height: 350px !important;
  }
}

@media (max-width: 480px) {
  .pre-slot-container {
    min-height: 300px !important;
  }
  
  .class-selection {
    min-height: 250px !important;
  }
}

/* === Z-INDEX FIXES === */
/* Ensure proper layering */
.slot-machine {
  position: relative !important;
  z-index: 20 !important;
}

.pre-slot-container {
  position: relative !important;
  z-index: 25 !important;  /* Above slot machine during animations */
}

#loadout-result {
  position: relative !important;
  z-index: 15 !important;  /* Below active elements */
}

.history-section {
  position: relative !important;
  z-index: 10 !important;
}

/* === DEBUG HELPERS === */
/* Add visual guides in development */
.debug-mode .slot-window::after {
  content: "Bottom line (winner should land here)";
  position: absolute;
  bottom: 80px;
  left: 0;
  right: 0;
  height: 1px;
  background: rgba(0, 255, 0, 0.5);
  pointer-events: none;
  font-size: 10px;
  color: #0f0;
}

/* === GRADIENT OVERLAYS === */
/* Adjust gradients for better visibility */
.slot-window::before,
.slot-window::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  height: 20px !important;  /* Thinner gradients */
  pointer-events: none;
  z-index: 10;
}

.slot-window::before {
  top: 0;
  background: linear-gradient(180deg, rgba(10,10,10,0.8) 0%, transparent 100%) !important;
}

.slot-window::after {
  bottom: 0;
  background: linear-gradient(0deg, rgba(10,10,10,0.8) 0%, transparent 100%) !important;
}