<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Target Calculation Debug</title>
    <style>
        body { 
            background: #111; 
            color: #0f0; 
            font-family: monospace; 
            padding: 20px;
        }
        .test { 
            margin: 20px 0; 
            padding: 10px; 
            border: 1px solid #0f0;
        }
    </style>
</head>
<body>
    <h2>Target Position Calculation Debug</h2>
    <div id="output"></div>
    
    <script>
        const ITEM_H = 80;
        const CENTER_OFFSET = 80;
        const output = document.getElementById('output');
        
        function log(msg) {
            output.innerHTML += `<div>${msg}</div>`;
        }
        
        // Test the calculation
        const winnerIndex = 20;
        const itemCount = 60;
        const cycleHeight = itemCount * ITEM_H; // 4800px
        
        log(`<div class="test">`);
        log(`<strong>Setup:</strong>`);
        log(`- Winner at index: ${winnerIndex}`);
        log(`- Item height: ${ITEM_H}px`);
        log(`- Cycle height: ${cycleHeight}px`);
        log(`- Center offset: ${CENTER_OFFSET}px`);
        log(`</div>`);
        
        log(`<div class="test">`);
        log(`<strong>Expected Wrapped Position:</strong>`);
        
        // Method 1: Direct calculation
        const method1 = -(winnerIndex * ITEM_H) + CENTER_OFFSET;
        log(`Method 1: -(${winnerIndex} * ${ITEM_H}) + ${CENTER_OFFSET} = ${method1}px`);
        
        // Method 2: Step by step
        const winnerTop = winnerIndex * ITEM_H; // 1600
        const scrollNeeded = winnerTop - CENTER_OFFSET; // 1520
        const wrappedPos = -scrollNeeded; // -1520
        log(`Method 2: Winner top=${winnerTop}, scroll=${scrollNeeded}, wrapped=${wrappedPos}px`);
        log(`</div>`);
        
        // Test unwrapped to wrapped conversion
        log(`<div class="test">`);
        log(`<strong>Unwrapped to Wrapped Test:</strong>`);
        
        const testUnwrapped = [8400, 8480, 13200, 13280];
        testUnwrapped.forEach(unwrapped => {
            let wrapped = unwrapped % cycleHeight;
            if (wrapped > 0) {
                wrapped = wrapped - cycleHeight;
            }
            log(`Unwrapped ${unwrapped} -> Wrapped ${wrapped}px`);
        });
        log(`</div>`);
        
        // Find correct unwrapped value
        log(`<div class="test">`);
        log(`<strong>Finding Correct Unwrapped Position:</strong>`);
        
        const startUnwrapped = 8400; // Example starting position
        let targetUnwrapped = startUnwrapped;
        const desiredWrapped = -1520;
        
        for (let i = 0; i < 100; i++) {
            targetUnwrapped = startUnwrapped + (i * ITEM_H);
            let testWrapped = targetUnwrapped % cycleHeight;
            if (testWrapped > 0) {
                testWrapped -= cycleHeight;
            }
            
            if (Math.abs(testWrapped - desiredWrapped) < 1) {
                log(`âœ“ Found at unwrapped=${targetUnwrapped}, wrapped=${testWrapped}px`);
                break;
            }
            
            if (i < 5 || (i >= 55 && i < 60)) {
                log(`  Try ${i}: unwrapped=${targetUnwrapped}, wrapped=${testWrapped}px`);
            }
        }
        log(`</div>`);
        
        // Show the actual problem
        log(`<div class="test" style="border-color: #f00;">`);
        log(`<strong>Current Bug:</strong>`);
        log(`We're landing at -1072.8px instead of -1520px`);
        log(`Difference: ${1520 - 1072.8}px = ${(1520 - 1072.8) / ITEM_H} items off`);
        log(`This suggests we're ${Math.round((1520 - 1072.8) / ITEM_H)} items too high`);
        log(`</div>`);
    </script>
</body>
</html>