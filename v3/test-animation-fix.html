<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .slot-test {
            width: 200px;
            height: 240px;
            border: 2px solid #ff3366;
            margin: 20px auto;
            overflow: hidden;
            position: relative;
        }
        
        .slot-items {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
        }
        
        .slot-item {
            height: 80px;
            border: 1px solid #666;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2a2a2a;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: #ff3366;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        button:hover {
            background: #ff4477;
        }
        
        .status {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .pass { color: #0f0; }
        .fail { color: #f00; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Animation Fix Test</h1>
        
        <div class="status" id="status">Ready to test...</div>
        
        <div class="slot-test">
            <div class="slot-items" id="testItems">
                <!-- Generate 30 items -->
            </div>
        </div>
        
        <div class="controls">
            <button onclick="initItems()">Initialize Items</button>
            <button onclick="testTransform()">Test Transform</button>
            <button onclick="animateToTarget()">Animate to -1520px</button>
            <button onclick="verifyPosition()">Verify Position</button>
        </div>
        
        <div class="status" id="log"></div>
    </div>
    
    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');
        const itemsEl = document.getElementById('testItems');
        
        function log(msg, isError = false) {
            const time = new Date().toLocaleTimeString();
            const className = isError ? 'fail' : 'pass';
            logEl.innerHTML += `<div class="${className}">[${time}] ${msg}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function initItems() {
            itemsEl.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const item = document.createElement('div');
                item.className = 'slot-item';
                item.textContent = `Item ${i + 1}`;
                if (i === 20) {
                    item.style.background = '#ff3366';
                    item.textContent = `WINNER ${i + 1}`;
                }
                itemsEl.appendChild(item);
            }
            log('Initialized 30 items, winner at index 20');
            statusEl.textContent = 'Items initialized';
        }
        
        function testTransform() {
            // Test if transform can be set
            itemsEl.style.transform = 'translate3d(0, -100px, 0)';
            const transform = itemsEl.style.transform;
            log(`Set transform to -100px, result: ${transform}`);
            
            // Check computed style
            const computed = window.getComputedStyle(itemsEl);
            log(`Computed transform: ${computed.transform}`);
            
            if (transform.includes('-100px')) {
                statusEl.textContent = '✅ Transform test PASSED';
                statusEl.className = 'status pass';
            } else {
                statusEl.textContent = '❌ Transform test FAILED';
                statusEl.className = 'status fail';
            }
        }
        
        function animateToTarget() {
            log('Starting animation to -1520px...');
            
            // Clear any existing transform
            itemsEl.style.transform = '';
            itemsEl.style.transition = 'none';
            itemsEl.offsetHeight; // Force reflow
            
            // Set starting position
            itemsEl.style.transform = 'translate3d(0, 0px, 0)';
            itemsEl.offsetHeight; // Force reflow
            
            // Enable transition
            itemsEl.style.transition = 'transform 1s ease-out';
            
            // Animate to target
            setTimeout(() => {
                itemsEl.style.transform = 'translate3d(0, -1520px, 0)';
                log('Applied transform: translate3d(0, -1520px, 0)');
                
                // Verify after animation
                setTimeout(() => {
                    verifyPosition();
                }, 1100);
            }, 10);
        }
        
        function verifyPosition() {
            const transform = itemsEl.style.transform;
            const computed = window.getComputedStyle(itemsEl);
            
            log(`Style transform: ${transform}`);
            log(`Computed transform: ${computed.transform}`);
            
            // Check if position is -1520px
            if (transform.includes('-1520px')) {
                statusEl.textContent = '✅ Position at -1520px - TEST PASSED!';
                statusEl.className = 'status pass';
                log('✅ WINNER CENTERED AT ROW 2!', false);
            } else {
                statusEl.textContent = '❌ Position NOT at -1520px - TEST FAILED';
                statusEl.className = 'status fail';
                log('❌ Position incorrect!', true);
                
                // Try to extract actual position
                const match = transform.match(/translate3d\([^,]+,\s*(-?\d+(?:\.\d+)?)px/);
                if (match) {
                    log(`Actual position: ${match[1]}px`, true);
                }
            }
        }
        
        // Initialize on load
        window.onload = () => {
            initItems();
        };
    </script>
</body>
</html>