<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Fixes Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: white;
            font-family: monospace;
        }
        .status {
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .status h2 {
            color: #FFD700;
            margin: 0 0 10px 0;
        }
        .metric {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        .metric strong {
            color: #00D4FF;
            display: inline-block;
            width: 200px;
        }
        .pass {
            color: #4CAF50;
        }
        .fail {
            color: #f44336;
        }
        .warning {
            color: #ff9800;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 2px solid #444;
            border-radius: 8px;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            background: #FF1493;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #ff69b4;
        }
    </style>
</head>
<body>
    <div class="status">
        <h2>Mobile Slot Machine Fix Test</h2>
        <div id="metrics">
            <div class="metric">
                <strong>Current View:</strong>
                <span id="view-type">Checking...</span>
            </div>
            <div class="metric">
                <strong>Item Count:</strong>
                <span id="item-count">Checking...</span>
            </div>
            <div class="metric">
                <strong>Winner Position:</strong>
                <span id="winner-pos">Checking...</span>
            </div>
            <div class="metric">
                <strong>Gap Status:</strong>
                <span id="gap-status">Checking...</span>
            </div>
            <div class="metric">
                <strong>Winner Highlight:</strong>
                <span id="winner-highlight">Checking...</span>
            </div>
        </div>
    </div>

    <div class="controls">
        <button onclick="checkStatus()">Check Status</button>
        <button onclick="triggerSpin()">Trigger Spin</button>
        <button onclick="toggleMobileView()">Toggle Mobile View</button>
    </div>

    <iframe id="game-frame" src="/"></iframe>

    <script>
        let isMobileView = window.innerWidth <= 768;

        function checkStatus() {
            const frame = document.getElementById('game-frame');
            const frameWindow = frame.contentWindow;
            const frameDoc = frame.contentDocument;

            // Check view type
            const viewType = frameWindow.innerWidth <= 768 ? 'Mobile' : 'Desktop';
            document.getElementById('view-type').textContent = viewType;
            document.getElementById('view-type').className = viewType === 'Mobile' ? 'warning' : 'pass';

            // Check item count
            const columns = frameDoc.querySelectorAll('.slot-column');
            let totalItems = 0;
            let expectedItems = viewType === 'Mobile' ? 250 : 50;
            
            columns.forEach(col => {
                const items = col.querySelectorAll('.slot-item');
                if (items.length > totalItems) totalItems = items.length;
            });

            document.getElementById('item-count').textContent = `${totalItems} items (expected: ${expectedItems})`;
            document.getElementById('item-count').className = totalItems >= expectedItems ? 'pass' : 'fail';

            // Check for gaps
            let hasGaps = false;
            columns.forEach(col => {
                const slotWindow = col.querySelector('.slot-window');
                const slotItems = col.querySelector('.slot-items');
                if (slotWindow && slotItems) {
                    const windowHeight = slotWindow.offsetHeight;
                    const itemsHeight = slotItems.scrollHeight;
                    if (itemsHeight < windowHeight * 2) {
                        hasGaps = true;
                    }
                }
            });

            document.getElementById('gap-status').textContent = hasGaps ? 'Gaps detected!' : 'No gaps - fully filled';
            document.getElementById('gap-status').className = hasGaps ? 'fail' : 'pass';

            // Check winner items
            const winners = frameDoc.querySelectorAll('[data-winner="true"]');
            const winnersWithClass = frameDoc.querySelectorAll('[data-winner="true"].winner');
            
            document.getElementById('winner-pos').textContent = `${winners.length} winners found`;
            document.getElementById('winner-pos').className = winners.length > 0 ? 'pass' : 'fail';

            document.getElementById('winner-highlight').textContent = 
                winnersWithClass.length > 0 ? 
                `${winnersWithClass.length} highlighted` : 
                'Not highlighted yet';
            document.getElementById('winner-highlight').className = 
                winnersWithClass.length > 0 ? 'pass' : 'warning';
        }

        function triggerSpin() {
            const frame = document.getElementById('game-frame');
            const frameWindow = frame.contentWindow;
            
            // Trigger a random spin
            const randomBtn = frameWindow.document.getElementById('random-all-btn');
            if (randomBtn) {
                randomBtn.click();
                setTimeout(checkStatus, 5000); // Check after animation
            }
        }

        function toggleMobileView() {
            const frame = document.getElementById('game-frame');
            if (isMobileView) {
                frame.style.width = '100%';
                isMobileView = false;
            } else {
                frame.style.width = '375px';
                isMobileView = true;
            }
            setTimeout(checkStatus, 500);
        }

        // Initial check after frame loads
        document.getElementById('game-frame').onload = function() {
            setTimeout(checkStatus, 1000);
        };

        // Auto-check every 10 seconds
        setInterval(checkStatus, 10000);
    </script>
</body>
</html>