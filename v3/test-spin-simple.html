<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Spin Test</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="spin-animation.css">
    <link rel="stylesheet" href="polish-styles.css">
    <style>
        body {
            background: #0a0a0a;
            color: #fff;
            padding: 20px;
        }
        .test-controls {
            text-align: center;
            margin: 20px 0;
        }
        .test-btn {
            background: #ff3366;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        .status-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #1a1a1a;
            padding: 10px;
            border: 1px solid #ff3366;
            border-radius: 5px;
            font-family: monospace;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Simple Spin Test</h1>
    
    <div class="status-display" id="statusDisplay">
        <div>Status: <span id="status">Ready</span></div>
        <div>Transform: <span id="transform">none</span></div>
        <div>Position: <span id="position">0px</span></div>
    </div>
    
    <div class="test-controls">
        <button class="test-btn" onclick="initSlots()">Initialize Slots</button>
        <button class="test-btn" onclick="startSpin()">Start Spin</button>
        <button class="test-btn" onclick="stopAt1520()">Stop at -1520px</button>
        <button class="test-btn" onclick="checkPosition()">Check Position</button>
    </div>
    
    <!-- Mini slot machine for testing -->
    <div class="slot-machine" style="max-width: 600px; margin: 20px auto;">
        <div class="slot-columns" style="display: flex; justify-content: center;">
            <div class="slot-column" data-type="test">
                <div class="column-header">TEST COLUMN</div>
                <div class="slot-window" style="height: 240px; overflow: hidden; position: relative;">
                    <div class="slot-items" id="testSlotItems"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="simple-spin-animation.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const transformEl = document.getElementById('transform');
        const positionEl = document.getElementById('position');
        const itemsContainer = document.getElementById('testSlotItems');
        
        let animEngine = null;
        
        function updateStatus() {
            const transform = itemsContainer.style.transform || 'none';
            transformEl.textContent = transform;
            
            const match = transform.match(/translate3d\([^,]+,\s*(-?\d+(?:\.\d+)?)px/);
            if (match) {
                positionEl.textContent = match[1] + 'px';
            } else {
                positionEl.textContent = '0px';
            }
        }
        
        function initSlots() {
            // Clear existing items
            itemsContainer.innerHTML = '';
            
            // Add 30 test items
            for (let i = 0; i < 30; i++) {
                const item = document.createElement('div');
                item.className = 'slot-item';
                item.style.height = '80px';
                item.style.display = 'flex';
                item.style.alignItems = 'center';
                item.style.justifyContent = 'center';
                item.style.border = '1px solid #333';
                
                if (i === 20) {
                    item.style.background = '#ff3366';
                    item.innerHTML = '<span>WINNER ' + (i + 1) + '</span>';
                } else {
                    item.innerHTML = '<span>Item ' + (i + 1) + '</span>';
                }
                
                itemsContainer.appendChild(item);
            }
            
            // Initialize animation engine
            animEngine = new SimpleSpinAnimation();
            
            statusEl.textContent = 'Initialized';
            updateStatus();
        }
        
        async function startSpin() {
            if (!animEngine) {
                alert('Initialize slots first!');
                return;
            }
            
            statusEl.textContent = 'Spinning...';
            
            // Get the column element
            const column = document.querySelector('.slot-column');
            
            // Start a simple spin
            animEngine.spinDuration = 2000; // 2 seconds
            await animEngine.spin([column], [-1520], 1, 1);
            
            statusEl.textContent = 'Spin complete';
            updateStatus();
        }
        
        function stopAt1520() {
            // Directly set position to test
            itemsContainer.style.transition = 'transform 0.5s ease-out';
            itemsContainer.style.transform = 'translate3d(0, -1520px, 0)';
            
            statusEl.textContent = 'Positioned at -1520px';
            updateStatus();
            
            // Check after transition
            setTimeout(() => {
                checkPosition();
            }, 600);
        }
        
        function checkPosition() {
            updateStatus();
            
            const transform = itemsContainer.style.transform || '';
            const computed = window.getComputedStyle(itemsContainer);
            
            console.log('=== Position Check ===');
            console.log('Style transform:', transform);
            console.log('Computed transform:', computed.transform);
            console.log('Computed position:', computed.position);
            
            if (transform.includes('-1520px')) {
                statusEl.textContent = '✅ PASS: At -1520px';
                statusEl.style.color = '#0f0';
            } else {
                statusEl.textContent = '❌ FAIL: Not at -1520px';
                statusEl.style.color = '#f00';
            }
        }
        
        // Auto-initialize on load
        window.onload = () => {
            initSlots();
        };
        
        // Update status every 100ms during testing
        setInterval(updateStatus, 100);
    </script>
</body>
</html>