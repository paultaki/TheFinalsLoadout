<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify Center Position</title>
    <style>
        body { 
            background: #111; 
            color: white; 
            font-family: monospace; 
            padding: 20px;
        }
        .viewport {
            width: 200px;
            height: 240px;
            border: 2px solid #0f0;
            overflow: hidden;
            position: relative;
            margin: 20px auto;
        }
        .items-container {
            position: absolute;
            width: 100%;
        }
        .item {
            height: 80px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #222;
        }
        .winner {
            background: #440000;
            border: 2px solid red;
            font-weight: bold;
        }
        .row-indicator {
            position: absolute;
            right: 10px;
            width: 100px;
            text-align: right;
            font-size: 12px;
            color: #0f0;
            pointer-events: none;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            background: #333;
            color: white;
            border: 1px solid #666;
            cursor: pointer;
        }
        .info {
            text-align: center;
            margin: 20px;
            padding: 20px;
            background: rgba(0,255,0,0.1);
            border: 1px solid #0f0;
        }
    </style>
</head>
<body>
    <h2 style="text-align: center;">Viewport Center Row Test</h2>
    
    <div class="viewport">
        <!-- Row indicators -->
        <div class="row-indicator" style="top: 0;">← Row 1 (Top)</div>
        <div class="row-indicator" style="top: 80px; color: yellow;">← Row 2 (CENTER)</div>
        <div class="row-indicator" style="top: 160px;">← Row 3 (Bottom)</div>
        
        <div class="items-container" id="container">
            <!-- Items will be added here -->
        </div>
    </div>
    
    <div class="controls">
        <button onclick="setPosition(-1600)">-1600px (Index 20 at top)</button>
        <button onclick="setPosition(-1520)">-1520px (Should center)</button>
        <button onclick="setPosition(-1440)">-1440px (Alternative)</button>
        <button onclick="setPosition(-1360)">-1360px (Index 20 at bottom)</button>
    </div>
    
    <div id="info" class="info">
        Position: <span id="pos">0</span>px<br>
        Winner (Index 20) is in: <span id="location">...</span>
    </div>

    <script>
        const container = document.getElementById('container');
        const posSpan = document.getElementById('pos');
        const locationSpan = document.getElementById('location');
        
        // Create 30 items (enough to see the pattern)
        for (let i = 0; i < 30; i++) {
            const item = document.createElement('div');
            item.className = 'item';
            if (i === 20) {
                item.className += ' winner';
                item.innerHTML = `<strong>WINNER (Index 20)</strong>`;
            } else {
                item.innerHTML = `Item ${i}`;
            }
            container.appendChild(item);
        }
        
        function setPosition(pos) {
            container.style.transform = `translateY(${pos}px)`;
            posSpan.textContent = pos;
            
            // Calculate where index 20 appears
            const winnerTop = Math.abs(pos) - (20 * 80);
            
            let location = '';
            if (winnerTop < 0) {
                location = 'Above viewport';
            } else if (winnerTop >= 0 && winnerTop < 80) {
                location = 'Row 1 (TOP)';
            } else if (winnerTop >= 80 && winnerTop < 160) {
                location = 'Row 2 (CENTER) ✓';
            } else if (winnerTop >= 160 && winnerTop < 240) {
                location = 'Row 3 (BOTTOM)';
            } else {
                location = 'Below viewport';
            }
            
            locationSpan.textContent = location;
            locationSpan.style.color = location.includes('CENTER') ? 'yellow' : 'white';
        }
        
        // Default to what we think is correct
        setPosition(-1520);
    </script>
</body>
</html>