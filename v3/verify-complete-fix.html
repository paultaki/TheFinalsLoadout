<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify Complete Fix</title>
  <style>
    body {
      background: #0a0a0a;
      color: #fff;
      font-family: 'Inter', monospace;
      padding: 20px;
      margin: 0;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      color: #ff3366;
      font-size: 2rem;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .test-card {
      background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .test-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff3366, #ff5577);
    }
    
    .test-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .status-pass { background: #0f0; color: #000; }
    .status-fail { background: #f00; color: #fff; }
    .status-pending { background: #666; color: #fff; }
    .status-testing { 
      background: #ff0; 
      color: #000;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .test-details {
      background: #0a0a0a;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
      font-family: monospace;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .metric {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #222;
    }
    
    .metric:last-child {
      border-bottom: none;
    }
    
    .metric-label {
      color: #888;
    }
    
    .metric-value {
      color: #fff;
      font-weight: bold;
    }
    
    .metric-value.good { color: #0f0; }
    .metric-value.bad { color: #f00; }
    .metric-value.warning { color: #ff0; }
    
    .control-panel {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 30px 0;
    }
    
    button {
      background: linear-gradient(135deg, #ff3366, #ff5577);
      color: #fff;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 51, 102, 0.3);
    }
    
    button:disabled {
      background: #444;
      cursor: not-allowed;
      transform: none;
    }
    
    iframe {
      width: 100%;
      height: 800px;
      border: 2px solid #333;
      border-radius: 12px;
      background: #000;
    }
    
    .summary {
      background: linear-gradient(135deg, #1a1a1a, #111);
      border: 2px solid #333;
      border-radius: 12px;
      padding: 20px;
      margin: 30px 0;
      text-align: center;
    }
    
    .summary-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: #ff3366;
    }
    
    .summary-stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #ff3366;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #888;
      margin-top: 5px;
    }
    
    .log {
      background: #0a0a0a;
      border: 1px solid #222;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
    }
    
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #111;
    }
    
    .log-entry:last-child {
      border-bottom: none;
    }
    
    .timestamp {
      color: #666;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <h1>üé∞ Complete Fix Verification Dashboard</h1>
    
    <div class="control-panel">
      <button id="runAllTests" onclick="runAllTests()">Run All Tests</button>
      <button id="testAnimation" onclick="testAnimation()">Test Animation</button>
      <button id="measureGap" onclick="measureGap()">Measure Gap</button>
      <button onclick="location.reload()">Reset</button>
    </div>
    
    <div class="test-grid">
      <!-- Test 1: Gap Between Sections -->
      <div class="test-card">
        <div class="test-title">
          <span class="status-icon status-pending" id="gap-status">‚è≥</span>
          <span>Gap Between Sections</span>
        </div>
        <div class="test-details">
          <div class="metric">
            <span class="metric-label">Header Bottom:</span>
            <span class="metric-value" id="header-bottom">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Columns Top:</span>
            <span class="metric-value" id="columns-top">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Gap Size:</span>
            <span class="metric-value" id="gap-size">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Status:</span>
            <span class="metric-value" id="gap-result">Pending</span>
          </div>
        </div>
      </div>
      
      <!-- Test 2: Spin Direction -->
      <div class="test-card">
        <div class="test-title">
          <span class="status-icon status-pending" id="spin-status">‚è≥</span>
          <span>Spin Direction (All Downward)</span>
        </div>
        <div class="test-details">
          <div class="metric">
            <span class="metric-label">Reel 1:</span>
            <span class="metric-value" id="reel-1-dir">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 2:</span>
            <span class="metric-value" id="reel-2-dir">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 3:</span>
            <span class="metric-value" id="reel-3-dir">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 4:</span>
            <span class="metric-value" id="reel-4-dir">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 5:</span>
            <span class="metric-value" id="reel-5-dir">-</span>
          </div>
        </div>
      </div>
      
      <!-- Test 3: Final Alignment -->
      <div class="test-card">
        <div class="test-title">
          <span class="status-icon status-pending" id="align-status">‚è≥</span>
          <span>Horizontal Alignment</span>
        </div>
        <div class="test-details">
          <div class="metric">
            <span class="metric-label">Reel 1 Position:</span>
            <span class="metric-value" id="reel-1-pos">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 2 Position:</span>
            <span class="metric-value" id="reel-2-pos">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 3 Position:</span>
            <span class="metric-value" id="reel-3-pos">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 4 Position:</span>
            <span class="metric-value" id="reel-4-pos">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Reel 5 Position:</span>
            <span class="metric-value" id="reel-5-pos">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Max Deviation:</span>
            <span class="metric-value" id="max-deviation">-</span>
          </div>
        </div>
      </div>
      
      <!-- Test 4: Viewport Height -->
      <div class="test-card">
        <div class="test-title">
          <span class="status-icon status-pending" id="viewport-status">‚è≥</span>
          <span>Viewport Height (3 Items)</span>
        </div>
        <div class="test-details">
          <div class="metric">
            <span class="metric-label">Viewport Height:</span>
            <span class="metric-value" id="viewport-height">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Item Height:</span>
            <span class="metric-value" id="item-height">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Visible Items:</span>
            <span class="metric-value" id="visible-items">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Status:</span>
            <span class="metric-value" id="viewport-result">Pending</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="summary" id="summary" style="display: none;">
      <div class="summary-title">Test Summary</div>
      <div class="summary-stats">
        <div class="stat">
          <div class="stat-value" id="tests-passed">0</div>
          <div class="stat-label">Passed</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="tests-failed">0</div>
          <div class="stat-label">Failed</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="success-rate">0%</div>
          <div class="stat-label">Success Rate</div>
        </div>
      </div>
    </div>
    
    <div class="log" id="log">
      <div class="log-entry">
        <span class="timestamp">[00:00:00]</span>
        <span>Dashboard initialized. Ready to test.</span>
      </div>
    </div>
    
    <iframe id="appFrame" src="/v3/index-working.html"></iframe>
  </div>
  
  <script>
    const frame = document.getElementById('appFrame');
    let testResults = {
      gap: null,
      spin: null,
      alignment: null,
      viewport: null
    };
    
    function log(message) {
      const logEl = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="timestamp">[${time}]</span><span>${message}</span>`;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
    }
    
    function updateStatus(testId, status) {
      const icon = document.getElementById(testId + '-status');
      icon.className = 'status-icon status-' + status;
      icon.textContent = status === 'pass' ? '‚úÖ' : 
                         status === 'fail' ? '‚ùå' : 
                         status === 'testing' ? 'üîÑ' : '‚è≥';
    }
    
    function updateMetric(id, value, status = '') {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = value;
        el.className = 'metric-value ' + status;
      }
    }
    
    async function measureGap() {
      log('Measuring gap between header and columns...');
      updateStatus('gap', 'testing');
      
      const doc = frame.contentDocument;
      const header = doc.querySelector('.slot-header');
      const columns = doc.querySelector('.slot-columns');
      
      if (header && columns) {
        const headerRect = header.getBoundingClientRect();
        const columnsRect = columns.getBoundingClientRect();
        const gap = columnsRect.top - headerRect.bottom;
        
        updateMetric('header-bottom', headerRect.bottom.toFixed(1) + 'px');
        updateMetric('columns-top', columnsRect.top.toFixed(1) + 'px');
        updateMetric('gap-size', gap.toFixed(1) + 'px', gap < 30 ? 'good' : 'bad');
        
        if (gap < 30) {
          updateMetric('gap-result', 'PASS ‚úÖ', 'good');
          updateStatus('gap', 'pass');
          testResults.gap = true;
          log(`‚úÖ Gap test PASSED: ${gap.toFixed(1)}px (< 30px)`);
        } else {
          updateMetric('gap-result', 'FAIL ‚ùå', 'bad');
          updateStatus('gap', 'fail');
          testResults.gap = false;
          log(`‚ùå Gap test FAILED: ${gap.toFixed(1)}px (> 30px)`);
        }
      }
    }
    
    async function testAnimation() {
      log('Starting animation test...');
      
      const doc = frame.contentDocument;
      const win = frame.contentWindow;
      
      // Find and click generate button
      const generateBtn = doc.querySelector('.generate-btn');
      if (!generateBtn) {
        log('‚ùå Generate button not found!');
        return;
      }
      
      generateBtn.click();
      log('Clicked generate button, monitoring animation...');
      
      // Monitor spin direction
      updateStatus('spin', 'testing');
      setTimeout(() => monitorSpinDirection(), 500);
      
      // Check final alignment after animation
      setTimeout(() => checkFinalAlignment(), 5000);
    }
    
    function monitorSpinDirection() {
      const doc = frame.contentDocument;
      const containers = doc.querySelectorAll('.slot-items');
      const positions = [];
      
      // Take initial measurement
      containers.forEach(c => {
        const transform = c.style.transform;
        const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
        positions.push(match ? parseFloat(match[1]) : 0);
      });
      
      // Take second measurement after 200ms
      setTimeout(() => {
        const newPositions = [];
        containers.forEach(c => {
          const transform = c.style.transform;
          const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
          newPositions.push(match ? parseFloat(match[1]) : 0);
        });
        
        // Calculate direction for each reel
        let allDownward = true;
        positions.forEach((pos, i) => {
          const change = newPositions[i] - pos;
          const direction = change < -5 ? 'DOWN ‚úÖ' : change > 5 ? 'UP ‚ùå' : 'STATIC';
          updateMetric(`reel-${i+1}-dir`, direction, change < 0 ? 'good' : 'bad');
          
          if (change >= 0) allDownward = false;
        });
        
        if (allDownward) {
          updateStatus('spin', 'pass');
          testResults.spin = true;
          log('‚úÖ Spin direction test PASSED: All reels spinning downward');
        } else {
          updateStatus('spin', 'fail');
          testResults.spin = false;
          log('‚ùå Spin direction test FAILED: Not all reels spinning downward');
        }
      }, 200);
    }
    
    function checkFinalAlignment() {
      log('Checking final alignment...');
      updateStatus('align', 'testing');
      
      const doc = frame.contentDocument;
      const containers = doc.querySelectorAll('.slot-items');
      const positions = [];
      
      containers.forEach((c, i) => {
        const transform = c.style.transform;
        const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
        const pos = match ? parseFloat(match[1]) : 0;
        positions.push(pos);
        updateMetric(`reel-${i+1}-pos`, pos.toFixed(1) + 'px', 
                    Math.abs(pos - (-1440)) < 5 ? 'good' : 'bad');
      });
      
      // Check if all positions are close to -1440px
      const targetPos = -1440;
      const deviations = positions.map(p => Math.abs(p - targetPos));
      const maxDeviation = Math.max(...deviations);
      
      updateMetric('max-deviation', maxDeviation.toFixed(1) + 'px', 
                  maxDeviation < 5 ? 'good' : 'bad');
      
      if (maxDeviation < 5) {
        updateStatus('align', 'pass');
        testResults.alignment = true;
        log(`‚úÖ Alignment test PASSED: Max deviation ${maxDeviation.toFixed(1)}px`);
      } else {
        updateStatus('align', 'fail');
        testResults.alignment = false;
        log(`‚ùå Alignment test FAILED: Max deviation ${maxDeviation.toFixed(1)}px`);
      }
      
      updateSummary();
    }
    
    function checkViewport() {
      log('Checking viewport height...');
      updateStatus('viewport', 'testing');
      
      const doc = frame.contentDocument;
      const windows = doc.querySelectorAll('.slot-window');
      const items = doc.querySelectorAll('.slot-item');
      
      if (windows.length > 0 && items.length > 0) {
        const viewportHeight = windows[0].offsetHeight;
        const itemHeight = items[0].offsetHeight;
        const visibleItems = Math.floor(viewportHeight / itemHeight);
        
        updateMetric('viewport-height', viewportHeight + 'px', 
                    viewportHeight === 240 ? 'good' : 'bad');
        updateMetric('item-height', itemHeight + 'px',
                    itemHeight === 80 ? 'good' : 'bad');
        updateMetric('visible-items', visibleItems,
                    visibleItems === 3 ? 'good' : 'bad');
        
        if (viewportHeight === 240 && itemHeight === 80 && visibleItems === 3) {
          updateMetric('viewport-result', 'PASS ‚úÖ', 'good');
          updateStatus('viewport', 'pass');
          testResults.viewport = true;
          log('‚úÖ Viewport test PASSED: 240px height, 3 items visible');
        } else {
          updateMetric('viewport-result', 'FAIL ‚ùå', 'bad');
          updateStatus('viewport', 'fail');
          testResults.viewport = false;
          log(`‚ùå Viewport test FAILED: ${viewportHeight}px height, ${visibleItems} items visible`);
        }
      }
    }
    
    function updateSummary() {
      const summary = document.getElementById('summary');
      summary.style.display = 'block';
      
      const results = Object.values(testResults);
      const passed = results.filter(r => r === true).length;
      const failed = results.filter(r => r === false).length;
      const total = passed + failed;
      const rate = total > 0 ? Math.round((passed / total) * 100) : 0;
      
      document.getElementById('tests-passed').textContent = passed;
      document.getElementById('tests-failed').textContent = failed;
      document.getElementById('success-rate').textContent = rate + '%';
      
      if (rate === 100) {
        log('üéâ ALL TESTS PASSED! The slot machine is working perfectly!');
      } else {
        log(`‚ö†Ô∏è ${failed} test(s) failed. Review the results above.`);
      }
    }
    
    async function runAllTests() {
      log('Starting comprehensive test suite...');
      document.getElementById('runAllTests').disabled = true;
      
      // Reset results
      testResults = { gap: null, spin: null, alignment: null, viewport: null };
      
      // Test 1: Gap
      await measureGap();
      await new Promise(r => setTimeout(r, 500));
      
      // Test 2: Viewport
      checkViewport();
      await new Promise(r => setTimeout(r, 500));
      
      // Test 3 & 4: Animation and Alignment
      await testAnimation();
      
      setTimeout(() => {
        document.getElementById('runAllTests').disabled = false;
      }, 6000);
    }
    
    // Wait for iframe to load
    frame.onload = function() {
      log('Application loaded successfully');
      log('Click "Run All Tests" to begin verification');
    };
  </script>
</body>
</html>