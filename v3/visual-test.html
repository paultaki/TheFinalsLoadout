<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Test - Three Issues Fixed</title>
  <style>
    body {
      background: #0a0a0a;
      color: #fff;
      font-family: 'Inter', sans-serif;
      padding: 20px;
      margin: 0;
    }
    
    h1 {
      text-align: center;
      color: #ff3366;
      margin-bottom: 30px;
    }
    
    .test-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .status-card {
      background: linear-gradient(135deg, #1a1a1a, #111);
      border: 2px solid #333;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    .status-card.pass {
      border-color: #0f0;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
    }
    
    .status-card.fail {
      border-color: #f00;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
    }
    
    .issue-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .issue-status {
      font-size: 2rem;
      margin: 15px 0;
    }
    
    .issue-details {
      font-size: 0.9rem;
      color: #888;
      margin-top: 10px;
    }
    
    iframe {
      width: 100%;
      height: 700px;
      border: 2px solid #333;
      border-radius: 12px;
    }
    
    .controls {
      text-align: center;
      margin: 30px 0;
    }
    
    button {
      background: linear-gradient(135deg, #ff3366, #ff5577);
      color: #fff;
      border: none;
      padding: 12px 30px;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.3s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 51, 102, 0.3);
    }
    
    .measurement {
      background: #111;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üé∞ The Finals Loadout - Three Issues Fixed</h1>
    
    <div class="status-grid">
      <!-- Issue 1: Gap -->
      <div class="status-card" id="gap-card">
        <div class="issue-title">Issue #1: Gap Between Sections</div>
        <div class="issue-status" id="gap-status">‚è≥</div>
        <div class="issue-details">
          <div class="measurement">Gap: <span id="gap-value">Measuring...</span></div>
          <div>Target: < 30px</div>
        </div>
      </div>
      
      <!-- Issue 2: Spin Direction -->
      <div class="status-card" id="spin-card">
        <div class="issue-title">Issue #2: All Spin Downward</div>
        <div class="issue-status" id="spin-status">‚è≥</div>
        <div class="issue-details">
          <div class="measurement">Direction: <span id="spin-value">Testing...</span></div>
          <div>Target: All negative Y movement</div>
        </div>
      </div>
      
      <!-- Issue 3: Alignment -->
      <div class="status-card" id="align-card">
        <div class="issue-title">Issue #3: Horizontal Alignment</div>
        <div class="issue-status" id="align-status">‚è≥</div>
        <div class="issue-details">
          <div class="measurement">Position: <span id="align-value">Testing...</span></div>
          <div>Target: All at -1440px</div>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <button onclick="runTest()">Run Complete Test</button>
      <button onclick="triggerSpin()">Trigger Spin</button>
      <button onclick="location.reload()">Reset</button>
    </div>
    
    <iframe id="app" src="/v3/index-working.html"></iframe>
  </div>
  
  <script>
    const frame = document.getElementById('app');
    let animationStarted = false;
    
    function updateCard(cardId, statusId, pass, emoji) {
      const card = document.getElementById(cardId);
      const status = document.getElementById(statusId);
      
      card.className = 'status-card ' + (pass ? 'pass' : 'fail');
      status.textContent = emoji;
    }
    
    function checkGap() {
      const doc = frame.contentDocument;
      const header = doc.querySelector('.slot-header');
      const columns = doc.querySelector('.slot-columns');
      
      if (header && columns) {
        const headerRect = header.getBoundingClientRect();
        const columnsRect = columns.getBoundingClientRect();
        const gap = columnsRect.top - headerRect.bottom;
        
        document.getElementById('gap-value').textContent = gap.toFixed(1) + 'px';
        
        if (gap < 30) {
          updateCard('gap-card', 'gap-status', true, '‚úÖ FIXED');
          return true;
        } else {
          updateCard('gap-card', 'gap-status', false, '‚ùå FAILED');
          return false;
        }
      }
      return false;
    }
    
    function checkSpinDirection() {
      const doc = frame.contentDocument;
      const containers = doc.querySelectorAll('.slot-items');
      
      if (containers.length === 0) return false;
      
      // Take two measurements
      const positions1 = [];
      containers.forEach(c => {
        const transform = c.style.transform;
        const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
        positions1.push(match ? parseFloat(match[1]) : 0);
      });
      
      setTimeout(() => {
        const positions2 = [];
        containers.forEach(c => {
          const transform = c.style.transform;
          const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
          positions2.push(match ? parseFloat(match[1]) : 0);
        });
        
        // Check if all moving downward (negative change)
        let allDown = true;
        let anyMoving = false;
        positions1.forEach((p1, i) => {
          const change = positions2[i] - p1;
          if (Math.abs(change) > 1) {
            anyMoving = true;
            if (change >= 0) allDown = false;
          }
        });
        
        if (anyMoving && allDown) {
          document.getElementById('spin-value').textContent = 'All Downward ‚úÖ';
          updateCard('spin-card', 'spin-status', true, '‚úÖ FIXED');
        } else if (anyMoving) {
          document.getElementById('spin-value').textContent = 'Mixed/Upward ‚ùå';
          updateCard('spin-card', 'spin-status', false, '‚ùå FAILED');
        }
      }, 200);
      
      return true;
    }
    
    function checkAlignment() {
      const doc = frame.contentDocument;
      const containers = doc.querySelectorAll('.slot-items');
      
      if (containers.length === 0) return false;
      
      const positions = [];
      containers.forEach(c => {
        const transform = c.style.transform;
        const match = transform ? transform.match(/translateY\((-?\d+(?:\.\d+)?)px\)/) : null;
        positions.push(match ? parseFloat(match[1]) : 0);
      });
      
      // Check if all at -1440px (¬±5px tolerance)
      const allAligned = positions.every(p => Math.abs(p - (-1440)) < 5);
      const avgPos = positions.reduce((a,b) => a+b, 0) / positions.length;
      
      document.getElementById('align-value').textContent = avgPos.toFixed(1) + 'px';
      
      if (allAligned) {
        updateCard('align-card', 'align-status', true, '‚úÖ FIXED');
        return true;
      } else {
        updateCard('align-card', 'align-status', false, '‚ùå FAILED');
        return false;
      }
    }
    
    function triggerSpin() {
      const doc = frame.contentDocument;
      const btn = doc.querySelector('.generate-btn');
      if (btn) {
        btn.click();
        animationStarted = true;
        
        // Check spin direction during animation
        setTimeout(() => checkSpinDirection(), 500);
        
        // Check final alignment after animation
        setTimeout(() => checkAlignment(), 5000);
      }
    }
    
    function runTest() {
      // Test 1: Check gap immediately
      checkGap();
      
      // Test 2 & 3: Trigger animation
      triggerSpin();
    }
    
    // Auto-check gap when page loads
    frame.onload = function() {
      setTimeout(() => {
        checkGap();
        console.log('Ready for testing. Click "Run Complete Test" to begin.');
      }, 1000);
    };
  </script>
</body>
</html>