<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Tour Tracker - Test Suite</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            color: #50c878;
            border-bottom: 2px solid #50c878;
            padding-bottom: 10px;
        }
        .test-section {
            background: #16213e;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #0f4c75;
        }
        .test-pass {
            color: #4CAF50;
            font-weight: bold;
        }
        .test-fail {
            color: #f44336;
            font-weight: bold;
        }
        .test-result {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #444;
        }
        th {
            background: #0f4c75;
            color: white;
        }
        tr:nth-child(even) {
            background: #1e3a5f;
        }
        .summary {
            background: #50c878;
            color: #000;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            font-size: 1.2em;
            text-align: center;
        }
        .summary.fail {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üß™ World Tour Tracker - Bug Fix Test Suite</h1>

    <div class="test-section">
        <h2>Test Setup</h2>
        <p>Testing the fixes for:</p>
        <ul>
            <li>‚úÖ Date handling (DD/MM/YYYY format)</li>
            <li>‚úÖ Running total calculation including quickAdd</li>
            <li>‚úÖ Proper date sorting</li>
            <li>‚úÖ "Today" badge display</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test Data</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Manual Points</th>
                    <th>Quick Add</th>
                    <th>Day Total</th>
                    <th>Expected Running Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>14/09/2025</td>
                    <td>110</td>
                    <td>0</td>
                    <td>110</td>
                    <td>110</td>
                </tr>
                <tr>
                    <td>15/09/2025</td>
                    <td>64</td>
                    <td>2</td>
                    <td>66</td>
                    <td>176</td>
                </tr>
                <tr>
                    <td>16/09/2025</td>
                    <td>27</td>
                    <td>25</td>
                    <td>52</td>
                    <td>228</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div id="testResults"></div>

    <script type="module">
        // Import the utilities
        import { parseDMY, compareDMY, isSameLocalDayDMY, formatDMY, toNumber } from './utils/date.js';
        import { computeRunningTotals } from './utils/progress.js';

        const results = [];
        let passCount = 0;
        let failCount = 0;

        function addResult(testName, expected, actual, passed) {
            const status = passed ? 'PASS' : 'FAIL';
            if (passed) passCount++;
            else failCount++;

            results.push({
                name: testName,
                status: status,
                expected: expected,
                actual: actual
            });
        }

        // Test 1: Date parsing and comparison
        try {
            const date1 = '14/09/2025';
            const date2 = '15/09/2025';
            const date3 = '16/09/2025';

            const cmp1 = compareDMY(date1, date2);
            const cmp2 = compareDMY(date2, date1);
            const cmp3 = compareDMY(date1, date1);

            addResult(
                'Date Comparison (14/09 vs 15/09)',
                'negative number',
                cmp1,
                cmp1 < 0
            );

            addResult(
                'Date Comparison (15/09 vs 14/09)',
                'positive number',
                cmp2,
                cmp2 > 0
            );

            addResult(
                'Date Comparison (same date)',
                '0',
                cmp3,
                cmp3 === 0
            );
        } catch (e) {
            addResult('Date Comparison', 'No error', e.message, false);
        }

        // Test 2: Running totals with quickAdd
        try {
            const entries = [
                { date: '16/09/2025', points: 27, quickAdd: 25 },
                { date: '14/09/2025', points: 110 },
                { date: '15/09/2025', points: 64, quickAdd: 2 }
            ];

            const computed = computeRunningTotals(entries);

            // Check sorting
            addResult(
                'Entries sorted by date',
                '["14/09/2025","15/09/2025","16/09/2025"]',
                JSON.stringify(computed.map(e => e.date)),
                computed[0].date === '14/09/2025' &&
                computed[1].date === '15/09/2025' &&
                computed[2].date === '16/09/2025'
            );

            // Check day points calculation
            addResult(
                'Day points (including quickAdd)',
                '[110, 66, 52]',
                JSON.stringify(computed.map(e => e.dayPoints)),
                computed[0].dayPoints === 110 &&
                computed[1].dayPoints === 66 &&
                computed[2].dayPoints === 52
            );

            // Check running totals
            addResult(
                'Running totals',
                '[110, 176, 228]',
                JSON.stringify(computed.map(e => e.runningTotal)),
                computed[0].runningTotal === 110 &&
                computed[1].runningTotal === 176 &&
                computed[2].runningTotal === 228
            );
        } catch (e) {
            addResult('Running Totals', 'No error', e.message, false);
        }

        // Test 3: Today badge
        try {
            const today = new Date();
            const todayDMY = formatDMY(today);
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayDMY = formatDMY(yesterday);

            addResult(
                'Today detection',
                'true for today, false for yesterday',
                `today: ${isSameLocalDayDMY(todayDMY)}, yesterday: ${isSameLocalDayDMY(yesterdayDMY)}`,
                isSameLocalDayDMY(todayDMY) === true &&
                isSameLocalDayDMY(yesterdayDMY) === false
            );
        } catch (e) {
            addResult('Today Detection', 'No error', e.message, false);
        }

        // Test 4: Number conversion
        try {
            addResult(
                'toNumber conversions',
                '[0, 5, 0, 10, 0]',
                JSON.stringify([
                    toNumber(null),
                    toNumber(5),
                    toNumber(undefined),
                    toNumber('10'),
                    toNumber('abc')
                ]),
                toNumber(null) === 0 &&
                toNumber(5) === 5 &&
                toNumber(undefined) === 0 &&
                toNumber('10') === 10 &&
                toNumber('abc') === 0
            );
        } catch (e) {
            addResult('Number Conversion', 'No error', e.message, false);
        }

        // Display results
        const resultsDiv = document.getElementById('testResults');

        results.forEach(result => {
            const section = document.createElement('div');
            section.className = 'test-result';
            section.innerHTML = `
                <div class="${result.status === 'PASS' ? 'test-pass' : 'test-fail'}">
                    ${result.status}: ${result.name}
                </div>
                <div style="margin-top: 10px;">
                    Expected: <code>${result.expected}</code><br>
                    Actual: <code>${result.actual}</code>
                </div>
            `;
            resultsDiv.appendChild(section);
        });

        // Summary
        const summary = document.createElement('div');
        summary.className = failCount === 0 ? 'summary' : 'summary fail';
        summary.innerHTML = `
            <strong>Test Results:</strong>
            ${passCount} passed, ${failCount} failed out of ${passCount + failCount} tests
            ${failCount === 0 ? '<br>‚úÖ All tests passed!' : '<br>‚ùå Some tests failed'}
        `;
        resultsDiv.appendChild(summary);
    </script>
</body>
</html>